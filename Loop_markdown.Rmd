---
params:
  input_la_choice: Bradford
  input_phase_choice: Secondary
title: "Education, Children's Social Care and Offending: A focus on `r params$input_la_choice` (Descriptive Statistics)"
author: "Department for Education"
header-includes:
- \usepackage{longtable}
- \usepackage{graphics}
- \usepackage{xparse}
- \usepackage{moresize}
- \usepackage{setspace}
- \usepackage{tcolorbox}
- \usepackage{wrapfig}
- \usepackage{helvet}
- \usepackage{sectsty}
- \usepackage{fancyhdr}
- \usepackage{xpatch}
- \usepackage{booktabs}
- \onehalfspacing
- \pagestyle{fancy}
- \definecolor{gssmidblue}{RGB}{32, 115, 188}
- \definecolor{dfeheadingblue}{RGB}{16, 79, 117}
- \renewcommand{\familydefault}{\sfdefault}
- \allsectionsfont{\color{dfeheadingblue}}
- \sectionfont{\color{dfeheadingblue}\fontsize{16}{18}\selectfont}
- \fancyhead[C]{}
- \fancyhead[RL]{}
- \fancyfoot[LR]{}
- \renewcommand{\headrulewidth}{0pt}
- \renewcommand{\footrulewidth}{0pt}
- \futurelet\TMPfootrule\def\footrule{{\color{gssmidblue}\TMPfootrule}}
- \usepackage{floatrow}
- \floatsetup[figure]{capposition=top}
- \usepackage[titles]{tocloft}
- \renewcommand{\cftdot}{}
- \AtBeginDocument{\let\maketitle\relax}
- \usepackage{cellspace}
- \usepackage{etoolbox}
- \colorlet{headercolour}{DarkSeaGreen}


output:
  pdf_document:
    df_print: paged
    toc: true
    includes:
      before_body: title.sty
urlcolor: blue
fontsize: 12pt
---

```{r write title page, include=FALSE}
connTitle <- file("title.sty")
writeLines(c("\\resizebox{48mm}{!}{\\includegraphics{images/Department_for_Education.png}}\n",
             "\\vspace*{0.24\\textheight}\n",
             "\\Huge{\\color{dfeheadingblue}\\raggedright\\textbf{Education, children's social care and offending, descriptive statistics}} \n",
             paste0("\\huge{\\color{dfeheadingblue}\\textbf{A focus on ",params$input_la_choice,"}}"),
             "\\vspace*{2\\baselineskip} \n",
             "\\normalsize \n \\newpage \n"), connTitle)
close(connTitle)
```


```{r load packages, include=FALSE}
library(readxl)
library(tidyverse)
library(reshape2)
library(dplyr)
library(dbplyr)
library(ggplot2)
library(waffle)
library(knitr)
library(kableExtra)
library(stringr)
library(gridExtra)
library(rmarkdown)
library(formattable)

#Set working directory
knitr::opts_knit$set(root.dir = './')
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
options(scipen=999)

safe_LA <- c('TlDJE','ExbVO', 'zfPKp',
             'uBH5D', 'EG67z', '9Hfya',
             'lqSj6', 'antN5', 'aoCSR',
             'aA5QM')

i <- params$input_la_choice

if (params$input_la_choice %in% safe_LA){
  data_file <- "data/170622_Dummy_data.xlsx"
} else {
  data_file <- "data/130722_outputs_SAFE_suppressed_FINAL.xlsx"
}

#IFERROR function
 IFERROR <- function(code, silent = FALSE) {
         tryCatch(code, error = function(c) {
           if (!silent) {"(number too small to report)"}
           else{code}})}

#'Not in' function
`%!in%` <- Negate(`%in%`)

datafile <- "data/130722_outputs_SAFE_suppressed_FINAL.xlsx"

```



```{r intro, include=FALSE}
offender_counts_school <- read_excel(data_file,
                                     sheet = 'No_pupils_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

offender_counts_home <- read_excel(data_file,
                                   sheet = 'No_pupils_hmLA(SAFE)') %>%
  filter(HOME_LA == i)

ever_flags <- read_excel(data_file,
                         sheet = 'Everflag_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

ever_flags_no_star <- read_excel(data_file,
                         sheet = 'Everflag_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

ever_flags_no_star[ever_flags_no_star == '*'] <- '(number too small to report)'
```


\color{black}

\newpage

# Summary

This analysis uses Ministry of Justice and Department for Education data to look at the education and children's social care background of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` local authority area. We focus on two main groups: children who had been cautioned or sentenced for any type of offence, and those who had been cautioned or sentenced for a serious violence offence. For the cohorts used in this analysis, there are approximately `r format(round(offender_counts_school$offenders, -1), big.mark=',')` children who had attended school in `r offender_counts_school$SCHOOL_LA` and been cautioned or sentenced for any offence, equivalent to `r offender_counts_school$prop_off`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`, and approximately `r format(round(offender_counts_school$sv, -1), big.mark=',')` children who had attended school in `r offender_counts_school$SCHOOL_LA` and been cautioned or sentenced for a serious violence offence - equivalent to `r offender_counts_school$prop_sv`% of the all-pupil cohort.

While this publication focuses on those that attended school in `r offender_counts_home$HOME_LA`, some of the accompanying tables include information on those that lived in `r offender_counts_home$HOME_LA` but did not necessarily attend school there. There are approximately `r format(round(offender_counts_home$offenders, -1), big.mark=',')` children that lived in `r offender_counts_home$HOME_LA` (regardless of where they attended school) who had been cautioned or sentenced for any offence, equivalent to `r offender_counts_home$prop_off`% of the all-pupil cohort that lived in `r offender_counts_home$HOME_LA`. There are approximately `r format(round(offender_counts_home$sv, -1), big.mark=',')` children that lived in `r offender_counts_home$HOME_LA` who had been cautioned or sentenced for a serious violence offence (equivalent to `r offender_counts_home$prop_sv`% of the all-pupil cohort). However, the primary focus of this analysis is on those who attended school in `r offender_counts_home$HOME_LA`, unless otherwise stated.

This publication follows a previous [national level publication](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1059556/Education_children_s_social_care_and_offending_descriptive_stats_FINAL.pdf) that looked at the education and social care background of children in England that had been cautioned or sentenced for an offence across England and Wales. We have conducted this analysis in order to inform the work of the ten SAFE (Support, Attend, Fulfil, Exceed) Taskforces (for more information see [Support for vulnerable young people in serious violence hotspots](https://www.gov.uk/government/news/support-for-vulnerable-young-people-in-serious-violence-hotspots)).  A further publication will follow, that uses more complex analytical methods to understand the relationships between education, children’s social care and offending, on a national level.

Equivalent analysis has been produced for each of the ten SAFE areas, which will then be followed by a dashboard containing all local authorities in England, due to be published in Autumn 2022. All of the data and findings in this publication refer to `r offender_counts_home$HOME_LA`. To see the findings for England or the other nine SAFE areas, please see [Education, children's social care and offending](https://www.gov.uk/government/publications/education-childrens-social-care-and-offending).

\newpage

# Introduction

This paper investigates the education and children's social care background of children who had been cautioned or sentenced for an offence and attended school in `r offender_counts_home$HOME_LA`, based on key variables from the Ministry of Justice and Department for Education data share which was undertaken in 2020. The data share covers offending data up to the end of 2017 and education and social care data up to the end of academic year 2017/18.

This descriptive statistics analysis has been produced to provide greater insight into the education and children's social care background of children who had been cautioned or sentenced for an offence. However, this analysis does not show, or intend to show, that there are any specific or general causal links between these characteristics and offending.

Section 1 includes a high-level analysis of demographic factors, including:

• Previous offending
• Gender
• Age
• Ethnicity
• Free School Meals eligibility

Section 2 includes analysis that relates to children's experiences whilst in school and/or care, including in relation to:

• Attainment
• Persistent Absence
• Permanent exclusions and Suspensions
• Alternative Provision
• Special Educational Needs
• Children with a Social Worker

For more details on the data share that this analysis is based on, refer to the separately published [Technical Note](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1059557/Education_children_s_social_care_and_offending_descriptive_stats_Technical_Note_FINAL.pdf), and Annex C at the end of this paper. The data and variables used in the analysis for this paper are presented in the accompanying tables (with the source table referenced in this paper, where relevant).

\newpage

## Defining the study population

### Defining the all-pupil cohort

The cohorts of children within this analysis include all pupils who finished key stage 2 (KS2) in 2007/08, 2008/09 or 2009/10, were aged 10 at the start of these academic years, and attended school in `r offender_counts_home$HOME_LA`. Therefore, this cohort has a key stage 4 (KS4) academic year of 2012/13, 2013/14 or 2014/15 amounting to approximately `r format(round(offender_counts_school$all, -2), big.mark=',')` children. For these children, all their records from Year 1 to Year 13 (or equivalent) are included. Pupils who do not have a KS4 record are not
included (See figure 1 below). Pupils who attended an independent primary or secondary school have been excluded from the data as their characteristics are not recorded, except for those registered in independent Alternative Provision (AP) settings[^46th_footnote]. The cohorts were selected in this way to maximise data coverage and balance data availability across each of the datasets provided in the share.

[^46th_footnote]: For a full definition of Alternative Provision, please see the dedicated section below.

Children that appear on a school census at the end of KS2 and the end of KS4 have been included in this analysis, with allowances for those that have moved ahead or been kept behind by one or more school years. Independent school that provide alternative provision have been included, however those with KS4 results at mainstream independent schools have been removed.

Results are provided for the all-pupil cohort in `r offender_counts_home$HOME_LA` (including all children who had been cautioned or sentenced for an offence) for comparison purposes[^2nd_footnote].

[^2nd_footnote]: Offender numbers and pupil population figures quoted in this analysis may differ when analysing different education variables, since the information on these variables may not be recorded for all offenders and pupils.

This publication will present statistics relating to the Local Authority (LA) of a child's school during the school year they entered when they were aged 15. We selected age 15 as this is the most common age at which children who had been cautioned or sentenced for a serious violence offence commit their first serious violence offence[^44th_footnote]. Where this isn't possible, the closest previous year has been used. We have also conducted analysis using the records of the LA of the child's home address when they were aged 15, which can be found in the accompanying tables.

[^44th_footnote]: See table 1.3.1 of the previously published [national statistics](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Fassets.publishing.service.gov.uk%2Fgovernment%2Fuploads%2Fsystem%2Fuploads%2Fattachment_data%2Ffile%2F1059481%2FEducation_children_s_social_care_and_offending_tables.xlsx&wdOrigin=BROWSELINK)

\newpage

```{r cohort table, echo=FALSE, fig.cap="**[Source: DfE-MoJ data share, table: ...]**"}
cohort_table <-  data.frame(
  `Academic Year` = c('2016/17', '2015/16', '2014/15', '2013/14', '2012/13', '2011/12', '2010/11', '2009/10', '2008/09', '2007/08', '2006/07', '2005/06', '2004/05', '2003/04', '2002/03'),
  `KS4 Academic Year 2014-15` = c("Year 13", "Year 12", "Year 11", "Year 10", "Year 9", "Year 8", "Year 7", "Year 6", "Year 5", "Year 4",
                                  "Year 3", "Year 2", "Year 1", "", ""),
  `KS4 Academic Year 2013-14` = c("", "Year 13", "Year 12", "Year 11", "Year 10", "Year 9", "Year 8", "Year 7", "Year 6", "Year 5", "Year 4",
                                  "Year 3", "Year 2", "Year 1", ""),
  `KS4 Academic Year 2012-13` = c("", "", "Year 13", "Year 12", "Year 11", "Year 10", "Year 9", "Year 8", "Year 7", "Year 6", "Year 5", "Year 4",
                                  "Year 3", "Year 2", "Year 1"),
  stringsAsFactors = FALSE
)

kable((cohort_table),
      col.names = gsub(" 1","/1",gsub("Academic Year ","",gsub("[.]"," ",names(cohort_table)))),
      caption = "Year group breakdown for the all-pupil cohort",
      format='latex') %>%
  row_spec(0, bold = T, background = "#9FB9C8")

```

The findings presented throughout this publication are the combined results of all three cohorts, with the exception of findings discussing:

a) KS4 attainment: This is due to the implementation of two major reforms in 2013/14[^3rd_footnote] which affect the calculation of KS4 performance measures data. Since the cohorts in the analysis are matched to years in the KS4 attainment data that fall either side of this reform, KS4 results for these cohorts cannot be combined to look at overall figures. Therefore, when analysing KS4 attainment, the analysis refers to the results of those with KS4 academic year 2014/15 as this provides the most recent indicator of academic achievement.

[^3rd_footnote]: The two major reforms referenced: 1) Professor Alison Wolf’s Review of Vocational Education recommendations which: restrict the qualifications counted; prevent any qualification from counting as larger than one GCSE; and cap the number of non-GCSEs included in performance measures at two per pupil, and 2) an early entry policy to only count a pupil’s first attempt at a qualification, in subjects counted in the English Baccalaureate.

b) Children known to children's social care: Full children in need (CIN) data is available from 2011/12, summer term[^4th_footnote]. Children are included in this CIN analysis if they had been recorded as a child in need on the 31st March in any period between the ages of 12 - 16. Those matched to earlier years in the KS4 attainment data will have less coverage than those matched to later years. For example: those with KS4 academic year 2012/13 have coverage from age 14 and above. To maximise coverage of the CIN data and avoid skewed results, analysis of children in need and children who are looked after is based on children
matched to KS4 academic year 2014/15 only.

[^4th_footnote]: The CIN census was introduced in 2008/09, and initially covered a reduced 6-month period. A full year collection was introduced in 2009 – 2010, however a number of local authorities were unable to provide a complete, clean children in need return for that year. Reviews were carried out on the CIN census and resulted in some data items being removed from the 2010 – 2011 collection onward.

### Defining the offending groups

'Children who had been cautioned or sentenced for an offence' relates to all children and young people in the linked data who attended school in `r offender_counts_home$HOME_LA`, were in the academic years
described above, and who been cautioned or sentenced for any offence recorded on the Police National Computer over the defined coverage period[^5th_footnote].

[^5th_footnote]: The data share covers offences in the period 2000 – 2017. However, to reduce the skew of the data, the offence may have been committed at any point over the defined coverage period related to the offending group’s academic year. Offences included in the analysis were committed in the period up to and including 31 August 2015, 31 August 2016, 31 August 2017 for the offending groups with KS2 academic year 2007/08, 2008/09, 2009/10 respectively. Offence age was also limited to 10 and over.

All cohorts in this analysis are limited to ages 10-17. This means that for each cohort, the last year of offending data would be during Year 13 (or equivalent). This is to ensure that each child had the same amount of time to offend - if the data was not limited by age, then children born in earlier years would have more years of data available to record offences, thereby skewing the results.

The analysis has identified approximately `r format(round(offender_counts_school$offenders, -1), big.mark=',')` children who had been cautioned or sentenced for an offence and attended school in `r offender_counts_school$SCHOOL_LA`, which is equivalent to `r offender_counts_school$prop_off`% of the all-pupil cohort that attended school in `r offender_counts_school$SCHOOL_LA`. In comparison, there were approximately `r format(round(offender_counts_home$offenders, -1), big.mark=',')` children who had been cautioned or sentenced for an offence lived in `r offender_counts_home$HOME_LA`, which is equivalent to `r offender_counts_home$prop_off`% of the all-pupil cohort that live in `r offender_counts_home$HOME_LA`.

As well as 'children who had been cautioned or sentenced for an offence', 'children who had been cautioned or sentenced for a serious violence offence' have also been included in this analysis. The definition of serious violence offences is based broadly on the following
categories of offence groups and offence types: indictable only 'violence against the person' offences, indictable only 'robbery offences', and triable either way or indictable only 'possession of weapons offences'[^6th_footnote].

[^6th_footnote]: A full list of offences included in the definition can be found in Annex B and the separate Technical Note.

The analysis has identified approximately `r format(round(offender_counts_school$sv, -1), big.mark=',')` children who had been cautioned or sentenced for a serious violence offence and attended school in `r offender_counts_school$SCHOOL_LA`, which is equivalent to `r offender_counts_school$prop_sv`% of the all-pupil cohort that attended school in `r offender_counts_school$SCHOOL_LA`. In comparison, there were approximately `r format(round(offender_counts_home$sv, -1), big.mark=',')` children who had been cautioned or sentenced for a serious violence offence and *lived* in `r offender_counts_home$HOME_LA`, which is equivalent to `r offender_counts_home$prop_sv`% of the all-pupil cohort that lived in `r offender_counts_home$HOME_LA`.

```{r offenders and sv offenders overlap, include=FALSE}

offender_counts_school_for_waffle <- offender_counts_school %>%
  select(all, offenders, sv) %>%
  mutate(offenders_that_are_sv = round((sv/offenders)*100, 0),
         pupils_that_are_offenders = round((offenders/all)*100, 0),
         offenders_that_arent_sv = 100 - offenders_that_are_sv,
         pupils_that_arent_offenders = 100 - pupils_that_are_offenders)

offender_counts_school_LHS <- offender_counts_school_for_waffle %>%
  select(offenders_that_are_sv, offenders_that_arent_sv)

offender_counts_school_RHS <- offender_counts_school_for_waffle %>%
  select(pupils_that_are_offenders, pupils_that_arent_offenders)


offender_counts_school_LHS_waffle <- waffle(
  offender_counts_school_LHS, rows=10, size=0.6, flip=TRUE,
                         colors=c("#08306b", "#2171b5"),
                         title="Children who were cautioned\nor sentenced for an offence",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("Serious\nviolence\noffence",
                               "Not a serious\nviolence\noffence")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


offender_counts_school_RHS_waffle <- waffle(
  offender_counts_school_RHS, rows=10, size=0.6, flip=TRUE,
                         colors=c("#08306b", "#6BACE6"),
                         title="All pupils",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned\nor sentenced for\nan offence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text

```

For those that attended school in `r offender_counts_school$SCHOOL_LA`, approximately `r round((offender_counts_school$sv/offender_counts_school$offenders)*100, 0)`% of the ‘children who had been cautioned or sentenced for an offence’ group are in the ‘children who had been cautioned or sentenced for a serious violence offence’ group.

```{r offenders vs sv offenders waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for an offence that had also been cautioned or sentenced for a serious violence offence, and the proportion of children who had been cautioned or sentence for an offence, for pupils matched to KS4 academic years 2012/13, 2013/14, 2014/15 [Source: DfE-MoJ data share, table: 1.1.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(offender_counts_school_LHS_waffle, offender_counts_school_RHS_waffle, ncol=2, widths=c(1,2))
```

## Key points on the analysis: interpreting results

Care should be taken when interpreting this analysis as the findings do not imply a causal link between the educational or children's social care
characteristics and being cautioned or sentenced for an offence. Future work using this data will aim to build upon this analysis to better understand the relationships between the outcomes and characteristics in this publication.

The education variables included in this paper have generally been analysed independently of each other. It is important to note that there may be links
between these key variables which have not been factored into the analysis, and other factors which could not be taken into account.

Children who had been cautioned or sentenced for a serious violence offence represent a small, atypical group of young people; their results should not be assumed to be representative of all children who had been cautioned or sentenced for an
offence or young people more generally.

The data used for this publication allows us to see what proportion of a certain offending group had a characteristic, as well as being able to see what
proportion of children with a characteristic are also in the offending groups. For example, approximately `r ever_flags_no_star$sv_prop_count_FSM`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r ever_flags_no_star$SCHOOL_LA` were known to had ever been eligible for free school meals (FSM), but it is not possible to conclude from these findings that there is a causal relationship between FSM eligibility and being cautioned or sentenced for a serious violence offence (or vice versa).

Indeed, those children who had been cautioned or sentenced for a serious violence offence identified as being eligible for FSM made up `r ever_flags_no_star$also_sv_prop_count_FSM`% of all pupils
known to be eligible for FSM. Whilst it can be said that most children who had ever been cautioned or sentenced for a serious violence offence had also been eligible for FSM at some stage, it is not true that most children eligible for FSM had also been cautioned or sentenced for a serious violence offence. This is a pattern which emerges throughout this analysis; it is therefore important to consider this when reading the publication.

In addition to those given above, there are other reasons why this analysis cannot draw causal links. For example, there are many additional factors
which could influence someone's offending behaviour for which the data is not available for this analysis. The factors looked at in this paper come from education, children's social care, and offending datasets, meaning there are many unobserved factors which have not been accounted for here, for example health characteristics.

Tests for statistical significance have been performed on certain outcomes in this analysis[^45th_footnote]. Where an outcome is deemed to be 'statistically significant', this means that we are relatively confident that the results given for `r ever_flags_no_star$SCHOOL_LA` are genuinely different from the national figure, and not due to random variation. More specifically, we have concluded that there is a less than 5% chance that the results are due to chance alone. These tests have been performed for children who had been cautioned or sentenced for a serious violence offence only (not the all-pupil cohort or children who had been cautioned or sentenced for any offence). Where we have undertaken this analysis, we have noted this in the text. When reading this publication, readers may want to compare with the national figures where are available [here](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1059556/Education_children_s_social_care_and_offending_descriptive_stats_FINAL.pdf)

[^45th_footnote]: Significance testing has been performed using the prop.test function in R, which is used for testing the null hypothesis that the proportions (probabilities of success) in several groups are the same, or that they equal certain values.

## Reporting on small numbers of children

In order to prevent the disclosure of sensitive data, any numbers in this publication that relate to less than 6 pupils have been replaced by the words 'number too small to report'. Where there are further risks of identification (for example where a suppressed number can be calculated using other numbers), numbers have been further suppressed. Due to the size variation across the ten SAFE Taskforce Local Authority areas, this happens more in some of the ten publications than others.

## Defining 'ever'

It is important to note that this analysis will not be directly comparable with other published government statistics. Unless otherwise specified, when
referencing whether a child has 'ever' had a certain characteristic, the analysis considers all periods up to the end of KS4. This methodology may differ from that of other published statistics where, for example, only the previous six years are considered. For this reason, figures discussed here may appear higher than those available in other publications.

```{r home vs school, include=FALSE}
home_vs_school <- read_excel(data_file,
                             sheet = 'hm_with_dif_scl(SAFE)') %>%
  filter(HOME_LA == i)

school_vs_home <- read_excel(data_file,
                             sheet = 'scl_with_dif_hm(SAFE)') %>%
  filter(SCHOOL_LA == i)

school_vs_home_no_star <- read_excel(data_file,
                             sheet = 'scl_with_dif_hm(SAFE)') %>%
  filter(SCHOOL_LA == i)

school_vs_home_no_star[school_vs_home_no_star == '*'] <- '(number too small to report)'

home_vs_school_no_star <- read_excel(data_file,
                             sheet = 'hm_with_dif_scl(SAFE)') %>%
  filter(HOME_LA == i)

home_vs_school_no_star[home_vs_school_no_star == '*'] <- '(number too small to report)'

home_vs_school_for_chart <- home_vs_school %>%
  select(prop_count_all_dif, prop_count_any_dif, prop_count_sv_dif, HOME_LA) %>%
  rename(`All pupils with a different school LA` = prop_count_all_dif,
         `Any offence with a different school LA` = prop_count_any_dif,
         `Serious Violence offence with a different school LA` = prop_count_sv_dif)

school_vs_home_for_chart <- school_vs_home %>%
  select(prop_count_all_dif, prop_count_any_dif, prop_count_sv_dif, SCHOOL_LA) %>%
  rename(`All pupils with a different home LA` = prop_count_all_dif,
         `Any offence with a different home LA` = prop_count_any_dif,
         `Serious Violence offence with a different home LA` = prop_count_sv_dif)

home_vs_school_for_chart <- home_vs_school_for_chart %>%
  mutate(across(everything(), as.character))

school_vs_home_for_chart <- school_vs_home_for_chart %>%
  mutate(across(everything(), as.character))

home_school_for_chart <- school_vs_home_for_chart %>%
  left_join(home_vs_school_for_chart, by = c("SCHOOL_LA" = "HOME_LA")) %>%
  select(-SCHOOL_LA) %>%
  pivot_longer(
    cols = c(
      'All pupils with a different home LA', 'Any offence with a different home LA', 'Serious Violence offence with a different home LA',
      'All pupils with a different school LA', 'Any offence with a different school LA', 'Serious Violence offence with a different school LA'),
    names_to = ("Proportion_with_different_LA")
  ) %>%
  mutate(Proportion_with_different_LA2 = str_wrap(Proportion_with_different_LA, width = 10))

home_school_for_chart <- home_school_for_chart %>% mutate(value = as.numeric(value)) %>%
  mutate(Group  = c('All Pupils', 'Any Offence', 'Serious Violence Offence', 'All Pupils', 'Any Offence', 'Serious Violence Offence'),
         diff_LA = c('Different home LA', 'Different home LA', 'Different home LA', 'Different school LA', 'Different school LA', 'Different school LA'))

home_school_chart <- ggplot(home_school_for_chart, aes(fill = diff_LA, y = value, x = Group)) +
  ggplot2::geom_bar(position = 'dodge', stat = 'identity') +
  labs(x = NULL, y="% of\nchildren with\na different\nLA") +
  geom_text(aes(label = paste0(value, "%")), vjust = -0.4, position = position_dodge(width = 1)) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black", size=12)) +
  scale_fill_manual(values = c("#08306b", "#2171b5")) +
  theme(axis.title.y=element_text(angle=0)) +
  theme(text=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text
```

## Difference between home and school Local Authorities

In some cases, a child's home and school LA can differ. `r home_vs_school_no_star$prop_count_any_dif`% (approximately `r format(round(home_vs_school_no_star$count_any_dif, -1), big.mark=',')` children) of children who had been cautioned or sentenced for an offence that had a home LA of `r home_vs_school_no_star$HOME_LA` had a different school LA . `r school_vs_home_no_star$prop_count_any_dif`% (approximately `r format(IFERROR(round(as.numeric(school_vs_home_no_star$count_any_dif), -1)), big.mark=',')` children) that had a school LA of `r home_vs_school_no_star$HOME_LA` had a different home LA.  In comparison, `r home_vs_school_no_star$prop_count_sv_dif`% (approximately `r format(IFERROR(round(home_vs_school_no_star$count_sv_dif, -1)), big.mark='.')` children) of children who had been cautioned or sentenced for a serious violence offence and had a home LA of `r home_vs_school_no_star$HOME_LA` had a different school LA. `r school_vs_home_no_star$prop_count_sv_dif`% (approximately `r format(IFERROR(round(school_vs_home_no_star$count_sv_dif, -1)), big.mark=',')` children) that had a school LA of `r home_vs_school_no_star$HOME_LA` had a different home LA. For the all-pupil cohort, `r home_vs_school_no_star$prop_count_all_dif`% (approximately `r format(round(home_vs_school_no_star$count_all_dif, -1), big.mark=',')` children) of children that had a home LA of `r home_vs_school_no_star$HOME_LA` had a different school LA. `r school_vs_home_no_star$prop_count_all_dif`% (approximately `r format(round(school_vs_home_no_star$count_all_dif, -1), big.mark=',')` children) that had a school LA of `r home_vs_school_no_star$HOME_LA` had a different home LA. These results are depicted in figure 2 below.

Please note that this publication does not include any information on where any of the offences took place - only the home or school LA of the child that had been cautioned or sentenced for the offence.

The remainder of this document refers only to children with a school LA of `r home_vs_school$HOME_LA`.

`r if(offender_counts_home$HOME_LA %in% 'Bradford' | offender_counts_home$HOME_LA %in% 'Sheffield'){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r home school chart, echo=FALSE, fig.cap="**Proportion of children with different home and school LAs. [Source: DfE-MoJ data share, table: 1.12.1 and 1.12.2]**"}
home_school_chart
```

\newpage

```{r previous offending, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
previous_offending <- read_excel(data_file,
                                 sheet = 'previous_offence_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

previous_offending_for_chart <- previous_offending %>%
  select(SCHOOL_LA, prop_previous) %>%
  rbind(c(previous_offending$SCHOOL_LA[1], 100 - previous_offending$prop_previous[1])) %>%
  mutate(`Previous offending` = as.character(c('Serious violence offence with a previous offence','Serious violence offence without a previous offence'))) %>%
  rename(`Proportion with a previous offence` = `prop_previous`)

previous_offending_for_chart$`Proportion with a previous offence` <- as.numeric(previous_offending_for_chart$`Proportion with a previous offence`)

previous_offending_chart <- ggplot(previous_offending_for_chart, aes(x = "", y = `Proportion with a previous offence`, fill = `Previous offending`)) +
  geom_bar(stat="identity", width=1) +
  coord_polar(theta = "y", start = 0, direction = -1) +
  geom_text(aes(x=1.65, label = paste0(`Proportion with a previous offence`, "%")), position = position_stack(vjust=0.5), size=4.5) +
  labs(x = NULL, y = NULL) +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title=element_blank()) +
  scale_fill_manual(values = c("#08306b", "#2171b5"), labels = c("Serious violence offence\nwith a previous offence", "Serious violence offence\nwithout a previous offence")) +
  theme(text=element_text(size=12, colour = 'black'), #change font size of all text
        axis.text=element_blank(), #remove axis text
        axis.line=element_blank(),
        axis.ticks=element_blank(),
        legend.text=element_text(size=12)) #change font size of legend text

significance_testing <- read_excel("20072022_sig_testing.xlsx",
                                 sheet = 'sv') %>%
  filter(LA == i)

significance_testing[significance_testing == '*'] <- '(number too small to report)'

```

\newpage

# Section One: Demographics

## Previous offending

In order to better understand offending trajectories for children who had been cautioned or sentenced for a serious violence offence, this analysis looks at the volume of offending which preceded a first serious violence offence.

`r (100-previous_offending$prop_previous)`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_home$HOME_LA` had not been cautioned or sentenced for a previous offence. The difference between these results and the national figure was `r (significance_testing$previous_offending)`.

```{r previous offending chart, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence with or without a prior offence, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 2.1.1]**"}
previous_offending_chart
```

```{r gender, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
gender <- read_excel(data_file,
                     sheet = 'Gender_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

gender_for_chart <- gender %>%
  select(prop_count_M, prop_any_count_M, prop_sv_count_M,
         prop_count_F, prop_any_count_F, prop_sv_count_F)

gender_for_chart <- t(gender_for_chart) %>%
  as.data.frame() %>%
  mutate(Group = c('All Pupils', 'Any Offence', 'Serious Violence Offence', 'All Pupils', 'Any Offence', 'Serious Violence Offence'),
         Gender = c('M', 'M', 'M', 'F', 'F', 'F')) %>%
  rename('perc' = 'V1')

gender_chart <- ggplot(gender_for_chart, aes(fill = Gender, Group, perc)) +
  ggplot2::geom_bar(stat = "identity") +
  labs(x=NULL, y="% male/female") +
  geom_text(aes(label = paste0(perc, "%"), group = Gender), color = "white", position = position_stack(vjust = 0.5), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5"), labels = c("Female", "Male")) +
  theme(axis.title.y=element_text(angle=0, size=12)) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        legend.text=element_text(size=12)) #change font size of legend text

```

\newpage

## Gender

Male pupils were over-represented amongst children who had been cautioned or sentenced for an offence and children who had been cautioned or sentenced for a serious violence offence -  `r gender$prop_any_count_M`% of those that had been cautioned or sentenced for any offence were male, and `r gender$prop_sv_count_M`% of those that were cautioned or sentenced for a serious violence offence were male. In comparison, `r gender$prop_count_M`% of the all-pupil cohort that attended school in `r gender$SCHOOL_LA` was male. For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$gender)`.

```{r gender chart, echo=FALSE, fig.cap="**The gender breakdown of offending and pupil group, for all pupils matched to KS4 academic years 2012/13, 2013/14, 2014/15. [Source: DfE-MoJ data share, table: 1.1.1]**"}
gender_chart
```

```{r age, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}

age <- read_excel(data_file,
                  sheet = 'Age_first_offence_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

age_for_chart <- age %>%
  select(OffenceStartAge, prop_off, prop_sv) %>%
  rename(`Any Offence` = prop_off, `Serious Violence Offence` = prop_sv) %>%
  pivot_longer(
    cols = c(`Any Offence`, `Serious Violence Offence`),
    names_to = ("Pupil Group"))

age_for_chart <- age_for_chart %>% mutate(value = as.numeric(value))

age_chart <-  ggplot(age_for_chart, aes(x=OffenceStartAge, y=value, group=`Pupil Group`)) +
  geom_line(aes(color=`Pupil Group`), size=1.5) +
  labs(x = "Age at first offence", y="% at age") +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black", size=12)) +
  scale_color_manual(values = c("#08306b", "#2171b5")) +
  theme(axis.title.y=element_text(angle=0, size=12)) +
  theme(text=element_text(size=12), #change font size of all text
        legend.text=element_text(size=12)) #change font size of legend #change font size of legend title

```

\newpage

## Age

`r if(offender_counts_home$HOME_LA == 'Birmingham'){"The most common ages at first offence for all those that were cautioned or sentenced for an offence and attended school in Birmingham were 16 and 17."}`

`r if(offender_counts_home$HOME_LA == 'Bradford'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Bradford was 15"}`

`r if(offender_counts_home$HOME_LA == 'Haringey'){"The most common ages at first offence for all those that were cautioned or sentenced for an offence and attended school in Haringey were 14 and 17."}`

`r if(offender_counts_home$HOME_LA == 'Lambeth'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Lambeth was 16"}`

`r if(offender_counts_home$HOME_LA == 'Leeds'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Leeds was 15"}`

`r if(offender_counts_home$HOME_LA == 'Liverpool'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Liverpool was 15"}`

`r if(offender_counts_home$HOME_LA == 'Manchester'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Manchester was 15"}`

`r if(offender_counts_home$HOME_LA == 'Newham'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Newham was 15"}`

`r if(offender_counts_home$HOME_LA == 'Sheffield'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Sheffield was 17"}`

`r if(offender_counts_home$HOME_LA == 'Southwark'){"The most common age at first offence for all those that were cautioned or sentenced for an offence and attended school in Southwark was 16"}`

The most common age at first serious violence offence for all those that were cautioned or sentenced for a serious violence offence and attended school in `r age$SCHOOL_LA[1]` was `r age$OffenceStartAge[which.max(age$prop_sv)]`. The chart below shows the distribution of the age at first offence in `r age$SCHOOL_LA[1]`[^7th_footnote].

[^7th_footnote]: All offences were included in the analysis of age at first offence for children who had been cautioned or sentenced for an offence irrespective of whether they were also serious violence offences. Serious violence offences only were included in the analysis for children who had been cautioned or sentenced for a serious violence offence.

`r if("*" %in% age$prop_off | "*" %in% age$prop_sv){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r age chart, echo=FALSE, fig.cap="**The proportion of children relative to their age at first offence by offending group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.3.1]**"}
age_chart
```

```{r ethnicity, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}

ethnic_minor <- read_excel(data_file,
                           sheet = 'Ethnicity_minor_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

ethnic_major <- read_excel(data_file,
                           sheet = 'Ethnicity_major_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

ethnic_major<- ethnic_major %>%
  mutate(across(everything(), as.character))

ethnic_major_long <- ethnic_major %>%
  select(EthnicGroupMajor, prop_all, prop_off, prop_sv) %>%
  rename(`All Pupils` = prop_all, `Any Offence` = prop_off, `Serious Violence Offence` = prop_sv) %>%
  pivot_longer(
    cols = c(`All Pupils`, `Any Offence`, `Serious Violence Offence`),
    names_to = ("Pupil_group")
  ) %>%
  mutate('Ethnic Group Major' = c('Any other ethnic group', 'Any other ethnic group', 'Any other ethnic group',
                                  'Asian', 'Asian', 'Asian',
                                  'Black', 'Black', 'Black',
                                  'Chinese', 'Chinese', 'Chinese',
                                  'Mixed', 'Mixed', 'Mixed',
                                  'Unclassified', 'Unclassified', 'Unclassified',
                                  'White', 'White', 'White'))

ethnic_major_long <- ethnic_major_long %>% mutate(value = as.numeric(value))

# Reverse the order of the ethnic_major_long to make labeling easier
ethnic_major_long <- ethnic_major_long %>% map_df(rev) %>% mutate(`Ethnic Group Major` =  as.factor(`Ethnic Group Major`),
                                                                  Pupil_group = as.factor(Pupil_group))

ethnic_major_chart <- ggplot(ethnic_major_long, aes(x=value, y=`Ethnic Group Major`, fill = `Ethnic Group Major`)) +
  geom_bar(stat = "identity") +
  labs(x = "% of ethnic group major", y=NULL) +
  geom_text(aes(label = paste0(value, "%")), vjust = 0, hjust=-0.1, size=4) +
  theme_classic() +
  theme(legend.position = "none", axis.text = element_text(color="black", size=12)) +
  scale_fill_manual(values = c("#08306b", "#08519c", "#2171b5", "#4292c6", "#6baed6", "#9ecae1", "#c6dbef"),
                    breaks=c("White","Unclassified", "Mixed", "Chinese", "Black","Asian", "Any other ethnic group")) +
  facet_wrap(~Pupil_group) +
  theme(strip.background = element_blank()) +
  xlim(0,105) +
  scale_y_discrete(labels = c("Any other\nethnic group","Asian","Black", "Chinese", "Mixed", "Unclassified", "White")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) + #change font size of legend text
  annotate("segment",x=0,xend=100,y=Inf,yend=Inf,color="black",lwd=1)

ethnic_major_all_not_suppressed <- ethnic_major %>%
  filter(prop_all != "*") %>%
  select(EthnicGroupMajor_full, all, prop_all) %>%
  mutate(prop_all = as.numeric(prop_all))

ethnic_major_off_not_suppressed <- ethnic_major %>%
    filter(prop_off != "*") %>%
    select(EthnicGroupMajor_full, offenders, prop_off) %>%
  mutate(prop_off = as.numeric(prop_off))

ethnic_major_sv_not_suppressed <- ethnic_major %>%
    filter(prop_sv != "*") %>%
    select(EthnicGroupMajor_full, sv, prop_sv) %>%
  mutate(prop_sv = as.numeric(prop_sv))

```

\newpage

## Ethnicity

Ethnicity[^8th_footnote] has two different categorisations in the school census - ethnic group major and ethnic group minor. Ethnic group major contains wider categories (Asian, Black, Chinese, White, Mixed, Unclassified, Any Other Ethnic Group) whereas ethnic group minor is more detailed[^9th_footnote].

[^8th_footnote]: Where a pupil’s ethnicity changes over time, the most recent ethnicity has been taken. Ethnicity information has been taken from the DfE school census, and from 2011, could only be completed by the child or their parents.

[^9th_footnote]: Ethnic group minor categories include Bangladeshi, Indian, Any Other Pakistani Background, Pakistani, Black African, Black Caribbean, Any Other Black Background, Chinese, Any Other Mixed Background, White and Asian, White and Black African, White and Black Caribbean, Information Not Yet Obtained, Any Other Ethnic Group, Refused, White British, White Irish, Traveller of Irish Heritage, Any Other White Background, Gypsy/Roma. For a more detailed breakdown of ethnic group minor, see accompanying publication tables.

The most common major ethnic group amongst all pupils with a school LA of `r ethnic_major$SCHOOL_LA[1]` was `r ethnic_major_all_not_suppressed$EthnicGroupMajor_full[which.max(ethnic_major_all_not_suppressed$prop_all)]` (`r max(ethnic_major_all_not_suppressed$prop_all)`%). The most common major ethnic group amongst children with a school LA of `r ethnic_major$SCHOOL_LA[1]` who had been cautioned or sentenced for an offence was `r ethnic_major_off_not_suppressed$EthnicGroupMajor_full[which.max(ethnic_major_off_not_suppressed$prop_off)]` (`r max(ethnic_major_off_not_suppressed$prop_off)`%) - for children who had been cautioned or sentenced for a serious violence offence with a school LA of `r ethnic_major$SCHOOL_LA[1]`, it was `r ethnic_major_sv_not_suppressed$EthnicGroupMajor_full[which.max(ethnic_major_sv_not_suppressed$prop_sv)]` (`r max(ethnic_major_sv_not_suppressed$prop_sv)`%).

`r if("*" %in% ethnic_major$prop_all | "*" %in% ethnic_major$prop_off | "*" %in% ethnic_major$prop_sv){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r ethnicity chart, echo=FALSE, fig.cap="**The proportion of all pupils split by ethnic group major, offending and pupil group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.2.1]**"}

ethnic_major_chart
```

```{r FSM, include=FALSE, fig.dim = c(8, 6), fig.cap="[Source: DfE-MoJ data share, table: ...]"}

ever_flags <- read_excel(data_file,
                         sheet = 'Everflag_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

ever_flags_no_star <- read_excel(data_file,
                         sheet = 'Everflag_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

ever_flags_no_star[ever_flags_no_star == '*'] <- '(number too small to report)'

#FSM chart
FSM_for_chart <- ever_flags %>%
  select(prop_count_FSM, any_prop_count_FSM, sv_prop_count_FSM)

FSM_for_chart <- t(FSM_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All Pupils', 'Any Offence', 'Serious Violence Offence')) %>%
  rename(`% eligible for FSM` = 'V1')

FSM_for_chart <- FSM_for_chart %>% mutate(`% eligible for FSM` = as.numeric(`% eligible for FSM`))

FSM_chart <- ggplot(FSM_for_chart, aes(x=`% eligible for FSM`, y=`Pupil Group`, fill = `Pupil Group`)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  labs(x="% eligible for FSM", y=NULL) +
  geom_text(aes(label = paste0(`% eligible for FSM`, "%")), hjust =-0.1, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "none", axis.text = element_text(color="black", size=12)) +
  scale_fill_manual(values = c("#08306b", "#08306b", "#08306b")) +
  xlim(0,100) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12)) #change font size of axis titles


#FSM waffle
FSM_for_waffle <- ever_flags %>%
  select(sv_prop_count_FSM, also_sv_prop_count_FSM) %>%
  mutate(sv_prop_count_FSM = round(sv_prop_count_FSM,0),
         also_sv_prop_count_FSM = round(also_sv_prop_count_FSM,0),
         non_sv_prop_count_FSM = 100 - sv_prop_count_FSM,
         non_sv_also_prop_count_FSM = 100 - also_sv_prop_count_FSM)

FSM_LHS <- FSM_for_waffle %>%
  select(sv_prop_count_FSM, non_sv_prop_count_FSM)

FSM_RHS <- FSM_for_waffle %>%
  select(also_sv_prop_count_FSM, non_sv_also_prop_count_FSM)

FSM_LHS_waffle <- waffle(FSM_LHS, rows=10, size=0.6, flip=TRUE,
                         colors=c("#08306b", "#2171b5"),
                         title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("Eligible\nfor FSM",
                               "Not eligible\nfor FSM")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text #change font size of legend title

FSM_RHS_waffle <- waffle(FSM_RHS, rows=10, size=0.6, flip=TRUE,
                         colors=c("#08306b", "#6BACE6"),
                         title="All pupils\neligible for FSM",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned or sentenced\nfor a serious violence offence",
                               "All other pupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text) #change font size of legend title
```

\newpage

## Free School Meals

Children who had been cautioned or sentenced for an offence that attended school in `r home_vs_school_no_star$HOME_LA` were more likely to be eligible for free school meals (FSM)[^10th_footnote] than the all-pupil cohort, with children who had been cautioned or sentenced for a serious violence offence having the highest proportion of those eligible for FSM.

[^10th_footnote]:  The metric for free school meals (FSM) used in this analysis is FSM eligibility. Children are FSM eligible if a claim has been made by them, or on their behalf, and eligibility has been confirmed.

`r ever_flags_no_star$any_prop_count_FSM`% of all children who had been cautioned or sentenced for an offence and had attended school in `r home_vs_school_no_star$HOME_LA` had ever been eligible for FSM (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$any_count_FSM), -1)), big.mark=',')` children), compared to `r ever_flags_no_star$sv_prop_count_FSM`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r home_vs_school_no_star$HOME_LA` (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$sv_count_FSM), -1)), big.mark=',')` children). This compares to `r ever_flags_no_star$prop_count_FSM`% of all pupils who attended school in `r home_vs_school_no_star$HOME_LA` and had ever been eligible for FSM (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$count_FSM), -1)), big.mark=',')` children). For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$FSM)`.

```{r FSM chart, echo=FALSE, fig.cap="**Proportion of all pupils eligible for free school meals (FSM) by offending and pupil group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.8.1]**"}
FSM_chart
```

However, whilst the majority of children who had been cautioned or sentenced for an offence and had attended school in `r home_vs_school_no_star$HOME_LA` had ever been eligible for FSM, it is not the case that the majority of children eligible for FSM were also cautioned or sentenced for an offence: only `r ever_flags_no_star$also_any_prop_count_FSM`% of those that had ever been eligible for FSM and had attended school in `r home_vs_school_no_star$HOME_LA` had also ever been cautioned or sentenced for an offence, and only `r ever_flags_no_star$also_sv_prop_count_FSM`% had ever been cautioned or sentenced for a serious violence offence.

```{r FSM waffle, echo=FALSE,  fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever been eligible for free school meals (FSM), and all pupils who had ever been eligible for FSM, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.8.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(FSM_LHS_waffle, FSM_RHS_waffle, ncol=2, widths=c(1,2))
```

```{r attainment, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
KS4_attainment <- read_excel(data_file,
                             sheet = 'KS4_attain_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

KS4_attainment[KS4_attainment == '*'] <- '(number too small to report)'

#KS4 chart
KS4_attainment_for_chart <- KS4_attainment %>%
  select(propcount_anypass, propcount_5AG, propcount_5AC, propanycount_anypass, propanycount_5AG, propanycount_5AC,
         propsvcount_anypass, propsvcount_5AG, propsvcount_5AC)

KS4_attainment_for_chart <- t(KS4_attainment_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All Pupils', 'All Pupils', 'All Pupils', 'Any Offence', 'Any Offence', 'Any Offence', 'Serious Violence Offence', 'Serious Violence Offence', 'Serious Violence Offence'),
         KS4_benchmark = c('Achieved any pass at GCSE or equiv.', 'Achieved 5 or more GCSE (or equiv.) passes A* - G incl. English and Maths',
                           'Achieved 5 or more GCSE (or equiv.) passes A* - C incl. English and Maths', 'Achieved any pass at GCSE or equiv.',
                           'Achieved 5 or more GCSE (or equiv.) passes A* - G incl. English and Maths', 'Achieved 5 or more GCSE (or equiv.) passes A* - C incl. English and Maths',
                           'Achieved any pass at GCSE or equiv.', 'Achieved 5 or more GCSE (or equiv.) passes A* - G incl. English and Maths',
                           'Achieved 5 or more GCSE (or equiv.) passes A* - C incl. English and Maths')) %>%
  rename(`% at\nKS4\nbenchmark` = 'V1')  %>%
  mutate(KS4_benchmark2 = str_wrap(KS4_benchmark, width = 10))

KS4_attainment_for_chart <- KS4_attainment_for_chart %>% mutate(`% at\nKS4\nbenchmark` = as.numeric(`% at\nKS4\nbenchmark`))

KS4_attainment_chart <- ggplot(KS4_attainment_for_chart, aes(fill=`Pupil Group`, y=`% at\nKS4\nbenchmark`, x=KS4_benchmark2)) +
  geom_bar(position='dodge', stat='identity') +
  geom_text(aes(label = paste0(`% at\nKS4\nbenchmark`, "%")), vjust = -0.4, hjust=0.5, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black"),
        axis.title.x = element_blank()) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6")) +
  ylim(0,105) +
  scale_x_discrete(limits = rev, labels = c("Achieved any pass\nat GCSE\nor equiv.",
                                            "Achieved 5 or\nmore GCSE\n(or equiv.)\npasses A* - G\nincl. English and Maths",
                                            "Achieved 5 or\nmore GCSE\n(or equiv.)\npasses A* - C\nincl. English and Maths")) +
  theme(axis.title.y=element_text(angle=0, size=12)) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

#KS2 chart
KS2_attainment <- read_excel(data_file,
                             sheet = 'KS2_attain_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

KS2_attainment_for_chart <- KS2_attainment %>%
  select(propcount_EngL4orabove,propcount_MatL4orabove,
         propcount_EngL4orabove_offenders, propcount_MatL4orabove_offenders,
         propcount_EngL4orabove_SV_offenders, propcount_MatL4orabove_SV_offenders)

KS2_attainment_for_chart <- t(KS2_attainment_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All Pupils', 'All Pupils',
                           'Any Offence', 'Any Offence',
                           'Serious Violence Offence', 'Serious Violence Offence')) %>%
  mutate(Subject = c('English', 'Maths', 'English', 'Maths', 'English', 'Maths')) %>%
  rename(`% at level 4 or above` = 'V1')

KS2_attainment_for_chart <- KS2_attainment_for_chart %>% mutate(`% at level 4 or above` = as.numeric(`% at level 4 or above`))

KS2_attainment_chart <- ggplot(KS2_attainment_for_chart, aes(fill=rev(Subject), x=`% at level 4 or above`, y=`Pupil Group`)) +
  geom_bar(position='dodge', stat='identity') +
  geom_text(aes(label = paste0(`% at level 4 or above`, "%")), vjust = 0, hjust=-0.15, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black"),
        axis.title.y = element_blank()) +
  scale_fill_manual(values = c("#08306b", "#2171b5"), breaks = c("Maths", "English"), labels=c("English","Mathematics")) +
  xlim(0,100) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

```

\newpage

# Section Two: School and Social Care Experience

## Attainment

A lower proportion of children who had been cautioned or sentenced for any offence and had attended school in `r offender_counts_school$SCHOOL_LA` achieved the expected standard in English and Maths at key stage 2 (KS2)[^11th_footnote], or achieved various key stage 4 (KS4) benchmarks, compared to the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`.

[^11th_footnote]: The figures discussed here are the combined results of all three cohorts, of whom reached the end of KS2 in 2007/08, 2008/09 and 2009/10. Based on the metrics used in this analysis, only a very small number of results for the 2009/10 cohort were withheld, in light of the
boycott of the delivery of end of KS2 National Curriculum tests. It was determined that a sufficient volume of results were available for this cohort, and that the results of all three cohorts could be combined. Please see here for more information regarding the 2009/10 KS2
National Curriculum tests results: [National curriculum assessments: KS2 and KS3, 2010](https://www.gov.uk/government/statistics/national-curriculum-assessments-at-key-stage-2-and-3-in-england-academic-year-2009-to-2010-provisional)

KS2 attainment in `r offender_counts_school$SCHOOL_LA` differed across English and Maths, with children who had been cautioned or sentenced for any offence tending to perform worse in English compared to Maths. `r KS2_attainment$propcount_EngL4orabove_offenders`% of children who had been cautioned or sentenced for an offence and `r KS2_attainment$propcount_EngL4orabove_SV_offenders`% of children who been cautioned or sentenced for a serious violence offence achieved a level 4 or above in English. In comparison, `r KS2_attainment$propcount_MatL4orabove_offenders`% of children who had been cautioned or sentenced for an offence and `r KS2_attainment$propcount_MatL4orabove_SV_offenders`% of children who had been cautioned or sentenced for a serious violence offence achieved a level 4 or above in Maths. This compares to `r KS2_attainment$propcount_EngL4orabove`% of the all-pupil cohort that achieved a level 4 or above in English and `r KS2_attainment$propcount_MatL4orabove`% of the all-pupil cohort that achieved a level 4 or above in Maths.

```{r KS2 attainment chart,  echo=FALSE, fig.cap="**Proportion of all pupils who achieved level 4 or above in English and Mathematics at key stage 2 (KS2) by offending and pupil group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.10.1]**"}
KS2_attainment_chart
```

\newpage

In 2014/15[^12th_footnote], `r KS4_attainment$propanycount_anypass`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` and `r KS4_attainment$propsvcount_anypass`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` achieved any pass at GCSE (or equivalent), compared with `r KS4_attainment$propcount_anypass`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`.

The results for those that achieved 5 or more GCSE (or equivalent) passes at grades A star - G follow a similar pattern: in 2014/15, `r KS4_attainment$propanycount_5AG`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` and `r KS4_attainment$propsvcount_5AG`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` achieved 5 A star - G at GCSE (or equivalent), compared with `r KS4_attainment$propcount_5AG`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`.

Similarly, for those that achieved 5 or more GCSE (or equivalent) passes at grades A star - C: in 2014/15, `r KS4_attainment$propanycount_5AC`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` and `r KS4_attainment$propsvcount_5AC`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` achieved 5 A star - G at GCSE (or equivalent), compared with `r KS4_attainment$propcount_5AC`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`.

[^12th_footnote]: The implementation of two major reforms in 2013/14 that affect the calculation of KS4 performance measures data mean that findings for KS4 attainment cannot be combined over the three year groups, and the analysis will refer to the results of those with KS4 academic year 2014/15 only.

`r if("*" %in% KS4_attainment$propcount_anypass | "*" %in% KS4_attainment$propcount_5AG | "*" %in% KS4_attainment$propcount_5AC | "*" %in% KS4_attainment$propanycount_anypass | "*" %in% KS4_attainment$propanycount_5AG | "*" %in% KS4_attainment$propanycount_5AC | "*" %in% KS4_attainment$propsvcount_anypass | "*" %in% KS4_attainment$propsvcount_5AG | "*" %in% KS4_attainment$propsvcount_5AC){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`


```{r KS4 attainment chart,  echo=FALSE, fig.cap="**Proportion of all pupils who achieved various key stage 4 (KS4) benchmarks by offending and pupil group, for pupils matched to KS4 academic year 2014/15 only. [Source: DfE-MoJ data share, table: 1.11.1]**"}
KS4_attainment_chart
```


```{r absence, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
#Same excel tabs as FSM for "ever"

Absence_timing <- read_excel(data_file,
                             sheet = 'PAPAUO_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

#Absence chart
Absence_for_chart <- ever_flags %>%
  select(prop_count_PA, any_prop_count_PA, sv_prop_count_PA, prop_count_PAUO, any_prop_count_PAUO, sv_prop_count_PAUO)

Absence_for_chart <- t(Absence_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All Pupils', 'Any Offence', 'Serious Violence Offence', 'All Pupils', 'Any Offence', 'Serious Violence Offence')) %>%
  mutate(`Absence Type` = c('Persistent absence', 'Persistent absence', 'Persistent absence',
                            'Persistent absence (unauthorised other)', 'Persistent absence (unauthorised other)', 'Persistent absence (unauthorised other)')) %>%
  rename(`% persistently absent` = 'V1') %>%
  mutate(`Absence Type` = str_wrap(`Absence Type`, width = 10))

Absence_for_chart <- Absence_for_chart %>% mutate(`% persistently absent` = as.numeric(`% persistently absent`))

Absence_chart <- ggplot(Absence_for_chart, aes(fill=`Pupil Group`, y=`% persistently absent`, x=`Absence Type`)) +
  geom_bar(position='dodge', stat='identity') +
  labs(x=NULL, y="% persistently\nabsent") +
  geom_text(aes(label = paste0(`% persistently absent`, "%")), vjust = -0.4, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6")) +
  ylim(0,100) +
  scale_x_discrete(labels = c("Persistent absence", "Persistent absence\n(unauthorised other)")) +
  theme(axis.title.y=element_text(angle=0, size=12)) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text


#Absence timing chart
Absence_timing_for_chart <- Absence_timing %>%
  select(prop_PASame_Term, prop_PA_Before_SV, prop_PA_After_SV, prop_PAUOSame_Term, prop_PAUO_Before_SV, prop_PAUO_After_SV)

Absence_timing_for_chart <- t(Absence_timing_for_chart) %>%
  as.data.frame() %>%
  mutate(Absence_type = factor(c('Persistent absence', 'Persistent absence', 'Persistent absence',
                          'Persistent absence (unauthorised other)', 'Persistent absence (unauthorised other)',
                          'Persistent absence (unauthorised other)'),levels=c("Persistent absence (unauthorised other)","Persistent absence"))) %>%
  mutate(Timing = c('2 - In the same term as the first serious violence offence', '1 - Before the first serious violence offence',
                    '3 - After the first serious violence offence', '2 - In the same term as the first serious violence offence',
                    '1 - Before the first serious violence offence', '3 - After the first serious violence offence')) %>%
  rename('perc_absence' = 'V1') %>%
  arrange(Timing)

Absence_timing_for_chart <- Absence_timing_for_chart %>% mutate(perc_absence = as.numeric(perc_absence))

Absence_timing_chart <- ggplot(Absence_timing_for_chart, aes(x= perc_absence, y=Absence_type, fill = Timing, group=rev(Timing))) +
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% with persistent absence timing", y=NULL) +
  geom_text(aes(label = paste0(perc_absence, "%"), group = rev(Timing)), position = position_stack(vjust = 0.5), vjust= -5.4, hjust=0, size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("Before the first\nserious violence offence",
                               "In the same term as the\nfirst serious violence offence",
                               "After the first\nserious violence offence")) +

  scale_y_discrete(labels = c("Persistent\nabsence\n(unauthorised\nother) timing","Persistent\nabsence\ntiming")) + theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text

#PA waffle

PA_for_waffle <- ever_flags %>%
  select(sv_prop_count_PA, also_sv_prop_count_PA) %>%
  mutate(sv_prop_count_PA = round(sv_prop_count_PA,0),
         also_sv_prop_count_PA = round(also_sv_prop_count_PA,0),
         non_sv_prop_count_PA = 100 - sv_prop_count_PA,
         non_sv_also_prop_count_PA = 100 - also_sv_prop_count_PA)

PA_LHS <- PA_for_waffle %>%
  select(sv_prop_count_PA, non_sv_prop_count_PA)

PA_RHS <- PA_for_waffle %>%
  select(also_sv_prop_count_PA, non_sv_also_prop_count_PA)

PA_LHS_waffle <- waffle(PA_LHS, rows=10, size=0.6, flip=TRUE,
                        colors=c("#08306b", "#2171b5"),
                        title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                        xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("Persistently\nabsent",
                               "Not\npersistently\nabsent")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


PA_RHS_waffle <- waffle(PA_RHS, rows=10, size=0.6, flip=TRUE,
                        colors=c("#08306b", "#6BACE6"),
                        title="All pupils who were\npersistently absent",
                        xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned\nor sentenced\nfor a serious violence\noffence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text
```

\newpage

## Persistent Absence

A child is said to be persistently absent (PA) if they miss 10% or more of the sessions they could possibly have attended in an academic year or term. Most sessions represent a half-day. For context, this would amount to between 6 and 7 days of a 13-week term or around 19 days for a school year[^13th_footnote]. This includes both authorised and unauthorised absences[^14th_footnote].

[^13th_footnote]: [The School Day and Year](https://www.legislation.gov.uk/uksi/1999/3181/regulation/3/made)

[^14th_footnote]:  For more information on the definition of pupil absences see [Pupil absence statistics: methodology](https://explore-education-statistics.service.gov.uk/methodology/pupil-absence-in-schools-in-england). This was changed from 15% to 10% in September 2015.

For the following analysis, a pupil was marked as having ever been persistently absent if they had missed over 10% of their possible sessions over the course of a school year, not a term.

It is worth noting that persistent absence can include various reasons for absence, including absence due to being suspended or permanently
excluded[^15th_footnote].

[^15th_footnote]:  The definition of persistent absence includes all possible reasons for absence, including children whose absence was unauthorised, but the school was still provided with a reason for that absence (for example, an unagreed family holiday). The analysis has included this additional metric of absence (PAUO), as a way of differentiating those whose absence was not authorised and were unable to provide a valid reason for that absence, from those not attending school for any reason.

Children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were more likely to be persistently absent for any reason than the all-pupil cohort.

`r ever_flags_no_star$any_prop_count_PA`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever been persistently absent (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$any_count_PA), -1)), big.mark=',')` children), compared to `r ever_flags_no_star$sv_prop_count_PA`% of children who had been
cautioned or sentenced for a serious violence offence (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$sv_count_PA), -1)), big.mark=',')` children). This compares to `r ever_flags_no_star$prop_count_PA`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$count_PA), -1)), big.mark=',')` children). For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$PA)`.

Schools use a set of national codes to record the reasons for any absences. As the rates of persistent absence are so high amongst the all-pupil cohort, we have used these codes below to analyse the reasons why children are marked as persistently absent[^16th_footnote].

[^16th_footnote]:  A breakdown of rates of persistent absence by reason code are included in the accompanying publication tables.

The absence reason 'persistent absence for "unauthorised other" reasons' (PAUO) is used as a closest available proxy for persistent truancy. Looking at this reason code in isolation, `r ever_flags_no_star$any_prop_count_PAUO`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever been PAUO, compared to `r ever_flags_no_star$sv_prop_count_PAUO`% of children who had been cautioned or sentenced for a serious violence offence. This compares to `r ever_flags_no_star$prop_count_PAUO`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`. For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$PAUO)`.

\newpage

```{r Absence chart, echo=FALSE, fig.cap="**Proportion of all pupils who had ever been persistently absent or persistently absent (unauthorised other) by offending and pupil group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.7.1]**"}
Absence_chart
```


Looking at the proportion of the persistently absent pupils who had ever been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA`: `r ever_flags_no_star$also_any_prop_count_PA`% of pupils who had ever been persistently absent pupils had been cautioned or sentenced for an offence, compared to `r ever_flags_no_star$also_sv_prop_count_PA`% who had been cautioned or sentenced for a serious violence offence. Therefore, whilst it can be said that the majority of children who had been cautioned or sentenced for a serious violence offence had ever been persistently absent, it is not the case that the majority of persistently absent pupils had also ever been cautioned or sentenced for a serious violence offence.

```{r PA waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had been persistently absent, and all pupils who had ever been persistently absent, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.7.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(PA_LHS_waffle, PA_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

Another possible reason for absence is due to a suspension[^17th_footnote], where the pupil has been temporarily removed from the school[^18th_footnote], and in some cases
permanent exclusion. If this reason code is removed from the calculation of persistent absence (so as to avoid overlap with the suspensions and permanent exclusions statistics included elsewhere in this publication), the proportions decrease slightly but follow the same pattern as above: `r ever_flags_no_star$any_prop_count_PA_without_E`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever been persistently absent, compared to `r ever_flags_no_star$sv_prop_count_PA_without_E`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA`. This compares to `r ever_flags_no_star$prop_count_PA_without_E`% of the all-pupil cohort in `r offender_counts_school$SCHOOL_LA`.

[^17th_footnote]:  Suspension is described in legislation as to exclude a pupil for one or more fixed periods. Non-attendance on disciplinary grounds. It can't be open-ended but must have a defined end date that is fixed at the time when the suspension is first imposed.

[^18th_footnote]: Where a child is not present in school due to a suspension or permanent exclusion they will be marked as absent for the first six consecutive days of that suspension or permanent exclusion provided no alternative provision has been arranged within those six
days, which will negatively influence the child’s attendance rate. Where alternative provision has been arranged, they will be marked as attending that setting. It is therefore possible for children that had received successive suspensions within a term or year to see their overall absence equate to 10% of sessions possible or more.

Looking at the reason code for those that were persistently absent due to suspensions or permanent exclusions (PAE) in isolation, `r ever_flags_no_star$any_prop_count_PAE`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever been PAE, compared to `r ever_flags_no_star$sv_prop_count_PAE`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA`. This compares to `r ever_flags_no_star$prop_count_PAE`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`.

### Timing of Persistent Absence and Persistent Absence Unauthorised Other

This analysis looks at children who had been cautioned or sentenced for a serious violence offence who had ever been flagged as persistently absent, and whether the first record of persistent absence occurred before, after or during the same school term as the first serious violence offence[^33rd_footnote].

[^33rd_footnote]: Termly absence data has been used in this analysis. Throughout the rest of the publication, annual absence data has been used.

Almost all (`r Absence_timing$prop_PA_Before_SV`%) children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` who had ever been recorded as persistently absent for any reason were first flagged as being so prior to their first serious violence offence. This compares to about `r Absence_timing$prop_PAUO_Before_SV`% for children that had ever been recorded as persistently absent (unauthorised other) in `r offender_counts_school$SCHOOL_LA` [^34th_footnote].

[^34th_footnote]: For children who were cautioned or sentenced for a serious violence offence, and had been persistently absent, the analysis compares whether the first school term they were flagged as persistently absent in, or PAUO, preceded the school term in which the serious violence offence took place.

`r if("*" %in% Absence_timing$prop_PASame_Term | "*" %in% Absence_timing$prop_PA_After_SV | "*" %in% Absence_timing$prop_PAUOSame_Term | "*" %in% Absence_timing$prop_PAUO_After_SV){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r Absence timing chart, echo=FALSE, fig.cap="**Timing of first record of persistent absence or persistent absence (unauthorised other) relative to the timing of children's first serious violence offence, for all pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 2.3.1]**"}
Absence_timing_chart
```

```{r exclusions and suspensions, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
#Same excel tabs as FSM for "ever"

#Excluded/suspended chart
ExclSus_for_chart <- ever_flags %>%
  select(prop_count_Sus, any_prop_count_Sus, sv_prop_count_Sus, prop_count_Excl, any_prop_count_Excl, sv_prop_count_Excl)

ExclSus_for_chart <- t(ExclSus_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All Pupils', 'Any Offence', 'Serious Violence Offence', 'All Pupils', 'Any Offence', 'Serious Violence Offence')) %>%
  mutate(`Excluded/Suspended` = c('Suspended', 'Suspended', 'Suspended', 'Permanently excluded', 'Permanently excluded', 'Permanently excluded')) %>%
  rename(`% suspended/permanently excluded` = 'V1')

ExclSus_for_chart <- ExclSus_for_chart %>% mutate(`% suspended/permanently excluded` = as.numeric(`% suspended/permanently excluded`))

ExclSus_for_chart$`Excluded/Suspended` <- factor(ExclSus_for_chart$`Excluded/Suspended`, levels = c('Excluded', 'Suspended'))

ExclSus_chart <- ggplot(ExclSus_for_chart, aes(fill=`Pupil Group`, y=`% suspended/permanently excluded`, x=`Excluded/Suspended`)) +
  geom_bar(position='dodge', stat='identity') +
  labs(x=NULL, y="%\nsuspended/\npermanently\nexcluded") +
  geom_text(aes(label = paste0(`% suspended/permanently excluded`, "%")), vjust = -0.4, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6")) +
  ylim(0,100) +
  scale_x_discrete(labels = c("Suspended", "Permanently excluded")) +
  theme(axis.title.y=element_text(angle=0, size=12)) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

#First suspension chart
first_sus_timing <- read_excel(data_file,
                               sheet = 'First_sus_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

first_sus_timing_for_chart <- first_sus_timing %>%
  select(grouped_overall, prop_svfirst_all, prop_susfirst_all) %>%
  pivot_longer(
    cols = c(prop_svfirst_all, prop_susfirst_all),
    names_to = ("Before_After")
  ) %>%
  mutate(grouped_overall2 = c('I - 1 - 29 days', 'G - 1 - 29 days', 'J - 30 - 59 days', 'F - 30 - 59 days', 'K - 60 - 89 days',
                              'E - 60 - 80 days', 'L - 90 - 179 days', 'D - 90 - 179 days', 'M - 180 -365 days', 'C - 180 -365 days',
                              'N - 1 - 2 years', 'B - 1 - 2 years', 'O - Over 2 years', 'A - Over 2 years', 'H - On same day',
                              'Z')) %>%
  arrange(grouped_overall2)

first_sus_timing_for_chart <- first_sus_timing_for_chart[1:15,] %>%
  select(-grouped_overall)

first_sus_timing_for_chart <- first_sus_timing_for_chart %>% mutate(value = as.numeric(value),
                                                                    time_group = c("Before", "Before", "Before","Before","Before","Before","Before",
                                                                                   "Same", "After", "After", "After","After","After","After","After"))

first_sus_timing_chart <- ggplot(first_sus_timing_for_chart, aes(y=value, x=grouped_overall2, fill=time_group)) +
  geom_bar(position='dodge', stat='identity') +
  labs(x=NULL, y="% with\ntiming") +
  geom_text(aes(label = paste0(value, "%")), hjust =0.5, vjust=-0.15, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title = element_blank(),
        axis.text = element_text(color="black", angle = 45, vjust = 0.5, hjust=1)) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels=c("First suspension\nprior to first\nserious violence offence",
                             "First suspension\non same day as first\nserious violence offence",
                             "First suspension\nafter first\nserious violence offence"),
                    breaks = c("Before", "Same", "After")) +
  scale_x_discrete(labels = c("Over 2 years", "1 - 2 years",  "180 -365 days", "90 - 179 days","60 - 80 days",
                              "30 - 59 days","1 - 29 days", "On same day", "1 - 29 days",  "30 - 59 days",
                              "60 - 89 days", "90 - 179 days", "180 -365 days", "1 - 2 years", "Over 2 years")) +
  geom_vline(xintercept ="H - On same day", linetype='dashed', color = 'grey') +
  theme(axis.title.y=element_text(angle=0, size=12)) +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text



#Closest suspension chart
closest_sus_timing <- read_excel(data_file,
                                 sheet = 'Closest_sus_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

closest_sus_timing_for_chart <- closest_sus_timing %>%
  select(grouped_overall, prop_svfirst_all, prop_susfirst_all) %>%
  pivot_longer(
    cols = c(prop_svfirst_all, prop_susfirst_all),
    names_to = ("Before_After")
  ) %>%
  mutate(grouped_overall2 = c('I - 1 - 29 days', 'G - 1 - 29 days', 'J - 30 - 59 days', 'F - 30 - 59 days', 'K - 60 - 89 days',
                              'E - 60 - 80 days', 'L - 90 - 179 days', 'D - 90 - 179 days', 'M - 180 -365 days', 'C - 180 -365 days',
                              'N - 1 - 2 years', 'B - 1 - 2 years', 'O - Over 2 years', 'A - Over 2 years', 'H - On same day',
                              'Z - On same day')) %>%
  arrange(grouped_overall2)

closest_sus_timing_for_chart <- closest_sus_timing_for_chart[1:15,] %>%
  select(-grouped_overall)

closest_sus_timing_for_chart <- closest_sus_timing_for_chart %>% mutate(value = as.numeric(value),
                                                                    time_group = c("Before", "Before", "Before","Before","Before","Before","Before",
                                                                                   "Same", "After", "After", "After","After","After","After","After"))


closest_sus_timing_chart <- ggplot(closest_sus_timing_for_chart, aes(y=value, x=grouped_overall2, fill=time_group)) +
  geom_bar(position='dodge', stat='identity') +
  labs(x=NULL, y="% with\ntiming") +
  geom_text(aes(label = paste0(value, "%")), hjust =0.5, vjust=-0.15, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title = element_blank(),
        axis.text = element_text(color="black", angle = 45, vjust = 0.5, hjust=1)) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels=c("Closest suspension\nprior to first\nserious violence offence",
                             "Closest suspension\non same day as first\nserious violence offence",
                             "Closest suspension\nafter first\nserious violence offence"),
                    breaks = c("Before", "Same", "After")) +
  scale_x_discrete(labels = c("Over 2 years", "1 - 2 years",  "180 -365 days", "90 - 179 days","60 - 80 days",
                              "30 - 59 days","1 - 29 days", "On same day", "1 - 29 days",  "30 - 59 days",
                              "60 - 89 days", "90 - 179 days", "180 -365 days", "1 - 2 years", "Over 2 years")) +
  geom_vline(xintercept ="H - On same day", linetype='dashed', color = 'grey') +
  theme(axis.title.y=element_text(angle=0, size=12))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text


#First exclusion chart
 first_excl_timing <- read_excel(data_file,
                                sheet = 'First_excl_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

first_excl_timing_for_chart <- first_excl_timing %>%
  select(grouped_overall, prop_svfirst_all, prop_exclfirst_all) %>%
  pivot_longer(
    cols = c(prop_svfirst_all, prop_exclfirst_all),
    names_to = ("Before_After")
  ) %>%
  mutate(grouped_overall2 = c('I - 1 - 29 days', 'G - 1 - 29 days', 'J - 30 - 59 days', 'F - 30 - 59 days', 'K - 60 - 89 days',
                              'E - 60 - 80 days', 'L - 90 - 179 days', 'D - 90 - 179 days', 'M - 180 -365 days', 'C - 180 -365 days',
                              'N - 1 - 2 years', 'B - 1 - 2 years', 'O - Over 2 years', 'A - Over 2 years', 'H - On same day',
                              'Z')) %>%
  arrange(grouped_overall2)
first_excl_timing_for_chart <- first_excl_timing_for_chart %>% filter(grouped_overall2!='Z')
first_excl_timing_for_chart <- first_excl_timing_for_chart  %>% mutate(value = as.numeric(value),
                                                                        time_group = c("Before", "Before", "Before","Before","Before","Before","Before",
                                                                                       "Same", "After", "After", "After","After","After","After", "After"))


first_excl_timing_chart <- ggplot(first_excl_timing_for_chart, aes(y=value, x=grouped_overall2, fill=time_group)) +
  geom_bar(position='dodge', stat='identity') +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x="", y="% with\ntiming") +
  geom_text(aes(label = paste0(value, "%")), hjust =0.5, vjust=-0.15, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title = element_blank(),
        axis.text = element_text(color="black", angle = 45, vjust = 0.5, hjust=1)) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels=c("First permanent exclusion\nprior to first\nserious violence offence",
                             "First permanent exclusion\non same day as first\nserious violence offence",
                             "First permanent exclusion\nafter first\nserious violence offence"),
                    breaks = c("Before", "Same", "After")) +
  scale_x_discrete(labels = c("Over 2 years", "1 - 2 years",  "180 -365 days", "90 - 179 days","60 - 80 days",
                              "30 - 59 days","1 - 29 days", "On same day", "1 - 29 days",  "30 - 59 days",
                              "60 - 89 days", "90 - 179 days", "180 -365 days", "1 - 2 years", "Over 2 years")) +
  geom_vline(xintercept ="H - On same day", linetype='dashed', color = 'grey') +
  theme(axis.title.y=element_text(angle=0, size=12))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text


#Closest exclusion chart
closest_excl_timing <- read_excel(data_file,
                                  sheet = 'Closest_excl_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

closest_excl_timing_for_chart <- closest_excl_timing %>%
  select(grouped_overall, prop_svfirst_all, prop_exclfirst_all) %>%
  pivot_longer(
    cols = c(prop_svfirst_all, prop_exclfirst_all),
    names_to = ("Before_After")
  ) %>%
  mutate(grouped_overall2 = c('I - 1 - 29 days', 'G - 1 - 29 days', 'J - 30 - 59 days', 'F - 30 - 59 days', 'K - 60 - 89 days',
                              'E - 60 - 80 days', 'L - 90 - 179 days', 'D - 90 - 179 days', 'M - 180 -365 days', 'C - 180 -365 days',
                              'N - 1 - 2 years', 'B - 1 - 2 years', 'O - Over 2 years', 'A - Over 2 years', 'H - On same day',
                              'Z')) %>%
  arrange(grouped_overall2)

closest_excl_timing_for_chart <- closest_excl_timing_for_chart %>% filter(grouped_overall2!='Z')
closest_excl_timing_for_chart <- closest_excl_timing_for_chart  %>% mutate(value = as.numeric(value),
                                                                       time_group = c("Before", "Before", "Before","Before","Before","Before","Before",
                                                                                      "Same", "After", "After", "After","After","After","After", "After"))

closest_excl_timing_chart <- ggplot(closest_excl_timing_for_chart, aes(y=value, x=grouped_overall2, fill=time_group)) +
  geom_bar(position='dodge', stat='identity') +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x="", y="% with\ntiming") +
  geom_text(aes(label = paste0(value, "%")), hjust =0.5, vjust=-0.15, position = position_dodge(width = 1)) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title = element_blank(),
        axis.text = element_text(color="black", angle = 45, vjust = 0.5, hjust=1, size=4)) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels=c("Closest permanent exclusion\nprior to first\nserious violence offence",
                             "Closest permanent exclusion\non same day as first\nserious violence offence",
                             "Closest permanent exclusion\nafter first\nserious violence offence"),
                    breaks = c("Before", "Same", "After")) +
  scale_x_discrete(labels = c("Over 2 years", "1 - 2 years",  "180 -365 days", "90 - 179 days","60 - 80 days",
                              "30 - 59 days","1 - 29 days", "On same day", "1 - 29 days",  "30 - 59 days",
                              "60 - 89 days", "90 - 179 days", "180 -365 days", "1 - 2 years", "Over 2 years")) +
  geom_vline(xintercept ="H - On same day", linetype='dashed', color = 'grey') +
  theme(axis.title.y=element_text(angle=0, size=14))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text



#Excluded waffle
Excl_for_waffle <- ever_flags %>%
  select(sv_prop_count_Excl, also_sv_prop_count_Excl) %>%
  mutate(sv_prop_count_Excl = round(sv_prop_count_Excl,0),
         also_sv_prop_count_Excl = round(also_sv_prop_count_Excl,0),
         non_sv_prop_count_Excl = 100 - sv_prop_count_Excl,
         non_sv_also_prop_count_Excl = 100 - also_sv_prop_count_Excl)

Excl_LHS <- Excl_for_waffle %>%
  select(sv_prop_count_Excl, non_sv_prop_count_Excl)

Excl_RHS <- Excl_for_waffle %>%
  select(also_sv_prop_count_Excl, non_sv_also_prop_count_Excl)

Excl_LHS_waffle <- waffle(Excl_LHS, rows=10, size=0.6, flip=TRUE,
                          colors=c("#08306b", "#2171b5"),
                          title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                          xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("Permanently\nexcluded",
                               "Not\npermanently\nexcluded")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


Excl_RHS_waffle <- waffle(Excl_RHS, rows=10, size=0.6, flip=TRUE,
                          colors=c("#08306b", "#6BACE6"),
                          title="All pupils who were\npermanently excluded",
                          xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned\nor sentenced\nfor a serious violence\noffence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text

#Suspended waffle
Sus_for_waffle <- ever_flags %>%
  select(sv_prop_count_Sus, also_sv_prop_count_Sus) %>%
  mutate(sv_prop_count_Sus = round(sv_prop_count_Sus,0),
         also_sv_prop_count_Sus = round(also_sv_prop_count_Sus,0),
         non_sv_prop_count_Sus = 100 - sv_prop_count_Sus,
         non_sv_also_prop_count_Sus = 100 - also_sv_prop_count_Sus)

Sus_LHS <- Sus_for_waffle %>%
  select(sv_prop_count_Sus, non_sv_prop_count_Sus)

Sus_RHS <- Sus_for_waffle %>%
  select(also_sv_prop_count_Sus, non_sv_also_prop_count_Sus)

Sus_LHS_waffle <- waffle(Sus_LHS, rows=10, size=0.6, flip=TRUE,
                         colors=c("#08306b", "#2171b5"),
                         title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                         xlab="1 square = 1 %") +
 theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("Suspended",
                               "Not\nsuspended")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


Sus_RHS_waffle <- waffle(Sus_RHS, rows=10, size=0.6, flip=TRUE,
                         colors=c("#08306b", "#6BACE6"),
                         title="All pupils who were\nsuspended",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned\nor sentenced\nfor a serious violence\noffence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


```

\newpage

## Suspensions and permanent exclusions

A suspension is where a pupil has been temporarily removed from the school[^19th_footnote], whilst a permanent exclusion is when a pupil is no longer allowed to attend a school[^20th_footnote].

[^19th_footnote]:  Prior to 2019/20, suspensions were referred to as fixed term exclusions.

[^20th_footnote]: Note, suspensions data can include lunchtime suspensions, but suspensions during lunchtime have not been included in this analysis. Please see full definition here: [Pupil exclusion statistics: methodology](https://explore-education-statistics.service.gov.uk/methodology/pupil-exclusion-statistics-methodology)

Children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were more likely to be both suspended and permanently excluded than the all-pupil cohort.

`r ever_flags_no_star$any_prop_count_Sus`% of all children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever received a suspension (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$any_count_Sus), -1)), big.mark=',')` children), compared to `r ever_flags_no_star$sv_prop_count_Sus`% of children who had been cautioned or sentenced for a serious violence offence (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$sv_count_Sus), -1)), big.mark=',')` children). This compares to `r ever_flags_no_star$prop_count_Sus`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$count_Sus), -1)), big.mark=',')` children).  For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$suspensions)`.

Overall, `r ever_flags_no_star$any_prop_count_Excl`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had been permanently excluded (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$any_count_Excl), -1)), big.mark=',')` children), compared with `r ever_flags_no_star$sv_prop_count_Excl`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$sv_count_Excl), -1)), big.mark=',')` children). This compares to `r ever_flags_no_star$prop_count_Excl`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(as.numeric(ever_flags_no_star$count_Excl), -1)), big.mark=',')` children).  For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$exclusions)`.

```{r ExclSus chart, echo=FALSE, fig.cap="**The proportion of all pupils who had a record of being suspended or permanently excluded by offending and pupil group, for all pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.9.1]**"}
ExclSus_chart
```

\newpage

In comparison to the proportions seen above, `r ever_flags_no_star$also_any_prop_count_Sus`% of suspended pupils that had attended school in `r offender_counts_school$SCHOOL_LA` had ever
been cautioned or sentenced for an offence, compared to `r ever_flags_no_star$also_sv_prop_count_Sus`% who had been cautioned or sentenced for a serious violence offence. This shows us that, whilst the majority of children who had been cautioned or sentenced for a serious violence offence had also been suspended, it is not the case that most suspended pupils have been cautioned or sentenced for a serious violence offence.

```{r Sus waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever been suspended, and all pupils who had ever been suspended, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.9.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(Sus_LHS_waffle, Sus_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

When looking at all children that had ever been permanently excluded and had attended school in `r offender_counts_school$SCHOOL_LA`, `r ever_flags_no_star$also_any_prop_count_Excl`% had ever been cautioned or sentenced for an offence, compared to `r ever_flags_no_star$also_sv_prop_count_Excl`% who had been cautioned or sentenced for a serious violence offence.

```{r Excl waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever been permanently excluded, and all pupils who had ever been permanently excluded, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.9.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(Excl_LHS_waffle, Excl_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

### Timing of suspensions and permanent exclusions

The following analysis first investigates the sequencing of suspensions and permanent exclusions with serious violence offences. It looks at both the child's first suspension or permanent exclusion and, in the case of multiple events, their closest suspension or permanent exclusion relative to their first serious violence offence.

*Did first suspensions / permanent exclusions commonly precede or follow first serious violence offences?*

Most children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` who had received a suspension, received their first suspension before their first serious violence offence.

`r if("*" %in% first_sus_timing$prop_susfirst_all | "*" %in% first_sus_timing$prop_svfirst_all ){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r first_sus chart, echo=FALSE, fig.cap="**Timing of children's first suspension relative to their first serious violence offence, for all pupils matched to KS4 academic years 2012/13, 2013/14, 2014/15. [Source: DfE-MoJ data share, table: 2.2.3]**"}
first_sus_timing_chart
```

\newpage

Many children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` who had received a permanent exclusion, also received their first permanent exclusion before their first serious violence offence.

`r if(offender_counts_home$HOME_LA == 'Birmingham' & ("*" %in% first_excl_timing$prop_susfirst_all | "*" %in% first_excl_timing$prop_svfirst_all)){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r first_excl chart, echo=FALSE, eval=offender_counts_home$HOME_LA == 'Birmingham', fig.cap="**Timing of children's first exclusion relative to their first serious violence offence, for all pupils matched to KS4 academic years 2012/13, 2013/14, 2014/15. [Source: DfE-MoJ data share, table: 2.2.1]**"}
first_excl_timing_chart
```

`r if(offender_counts_home$HOME_LA %!in% 'Birmingham'){"*Chart has been suppressed due to small numbers.*"}`

\newpage

*Did the closest suspensions[^35th_footnote] / permanent exclusions commonly precede or follow serious violence offences?*

[^35th_footnote]: Where children who had been cautioned or sentenced for an offence had received multiple suspensions/permanent exclusions, the analysis defined closest as the shortest amount of time between the start of the suspensions/permanent exclusions and the first serious violence offence date'

Similar to the first suspension or permanent exclusion seen above, many children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` received their closest suspension or permanent exclusion before their first serious violence offence. There was also often a long period of time in between the closest suspension or permanent exclusion and the first serious violence offence[^36th_footnote].

[^36th_footnote]: See accompanying tables for a full breakdown of the length of time between first/closest suspensions and permanent exclusions and the first serious violence offence.

`r if("*" %in% closest_sus_timing$prop_susfirst_all | "*" %in% closest_sus_timing$prop_svfirst_all ){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r closest_sus chart, echo=FALSE, fig.cap="**Timing of children's closest suspension relative to their first serious violence offence, for all pupils matched to KS4 academic years 2012/13, 2013/14, 2014/15. [Source: DfE-MoJ data share, table: 2.2.7]**"}
closest_sus_timing_chart
```

`r if(offender_counts_home$HOME_LA == 'Birmingham' & ("*" %in% closest_excl_timing$prop_susfirst_all | "*" %in% closest_excl_timing$prop_svfirst_all)){"*Please note: gaps in the below chart indicate spaces where data has been suppressed due to small numbers*"}`

```{r closest_excl chart, echo=FALSE,  eval=offender_counts_home$HOME_LA == 'Birmingham', fig.cap="**Timing of children's closest permanent exclusion relative to their first serious violence offence, for all pupils matched to KS4 academic years 2012/13, 2013/14, 2014/15. [Source: DfE-MoJ data share, table: 2.2.5]**"}
closest_excl_timing_chart
```

`r if(offender_counts_home$HOME_LA %!in% 'Birmingham'){"*Chart has been suppressed due to small numbers.*"}`

```{r AP, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
#Same excel tabs as FSM for "ever"

AP_for_chart <- ever_flags %>%
  select(prop_count_AP, any_prop_count_AP, sv_prop_count_AP)

AP_for_chart <- t(AP_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All pupils', 'Any offence', 'Serious Violence Offence')) %>%
  rename(`% ever attended AP` = 'V1')

AP_for_chart <- AP_for_chart %>% mutate(`% ever attended AP` = as.numeric(`% ever attended AP`))

AP_chart <- ggplot(AP_for_chart, aes(x=`% ever attended AP`, y=`Pupil Group`, fill = `Pupil Group`)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  labs(x="% ever attended AP", y=NULL) +
  geom_text(aes(label = paste0(`% ever attended AP`, "%")), hjust =-0.1, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "none", axis.text = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#08306b", "#08306b")) +
  xlim(0,100)  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

#AP timing
AP_timing <- read_excel(data_file,
                        sheet = 'AP_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

AP_timing_no_star <- read_excel(data_file,
                  sheet = 'AP_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

AP_timing_no_star[AP_timing_no_star == '*'] <- '(number too small to report)'

AP_timing_for_chart <- AP_timing %>%
  select(prop_AP_Before_SV, prop_APSame_Term, prop_AP_After_SV)

AP_timing_for_chart <- t(AP_timing_for_chart) %>%
  as.data.frame() %>%
  mutate(Timing = c( '1 - Before the first serious violence offence', '2 - In the same term as the first serious violence offence',
                    '3 - After the first serious violence offence')) %>%
  rename(`% with AP timing` = 'V1') %>%
  arrange(Timing)

AP_timing_for_chart <- AP_timing_for_chart %>% mutate(`% with AP timing` = as.numeric(`% with AP timing`),
                                                      pupil_group = c("Serious Violence Offence","Serious Violence Offence","Serious Violence Offence"))


AP_timing_chart <- ggplot(AP_timing_for_chart, aes(x=`% with AP timing`, y= pupil_group, fill = Timing, group=rev(Timing)))+
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% with AP timing", y=NULL) +
  geom_text(aes(label = paste0(`% with AP timing`, "%"), group = rev(Timing)),  position = position_stack(vjust = 0.5), vjust= -13, hjust=0,size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text.x = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("Before the first\nserious violence\noffence",
                               "In the same term\nas the first serious\nviolence offence",
                               "After the first\nserious violence\noffence"))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text


#AP waffle
AP_for_waffle <- ever_flags %>%
  select(sv_prop_count_AP, also_sv_prop_count_AP) %>%
  mutate(sv_prop_count_AP = round(sv_prop_count_AP,0),
         also_sv_prop_count_AP = round(also_sv_prop_count_AP,0),
         non_sv_prop_count_AP = 100 - sv_prop_count_AP,
         non_sv_also_prop_count_AP = 100 - also_sv_prop_count_AP)

AP_LHS <- AP_for_waffle %>%
  select(sv_prop_count_AP, non_sv_prop_count_AP)

AP_RHS <- AP_for_waffle %>%
  select(also_sv_prop_count_AP, non_sv_also_prop_count_AP)

AP_LHS_waffle <- waffle(AP_LHS, rows=10, size=0.6, flip=TRUE,
                        colors=c("#08306b", "#2171b5"),
                        title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                        xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("Attended AP",
                               "Did not\nattend AP")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


AP_RHS_waffle <- waffle(AP_RHS, rows=10, size=0.6, flip=TRUE,
                        colors=c("#08306b", "#6BACE6"),
                        title="All pupils who had ever\nattended AP",
                        xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned or sentenced\nfor a serious violence offence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


```

\newpage

## Alternative Provision

Alternative Provision (AP) is full or part-time education arranged by:

a) local authorities, either directly or working with schools, for pupils who, because of permanent exclusion, illness or other reasons, would not otherwise receive suitable education.

b) schools for pupils to improve their behaviour off-site, or during a
suspension

The education often takes place at a pupil referral unit (PRU), AP academy or free school, known collectively as the 'state place-funded AP' sector.

However, alternative provision placements can also be arranged in independent schools, Further Education colleges or unregistered education settings, known as the 'independent AP' sector. Some of the pupils identified in the data as attending independent and unregistered AP settings were registered in independent special schools named on their Education, Health and Care plans, some of which do not meet the Department for Education's (DfE) statutory definition of AP.

Children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were more likely to have attended AP than the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`[^21st_footnote].

[^21st_footnote]: Please see here for more information on AP statutory guidance: [Alternative Provision Statutory Guidance](https://www.gov.uk/government/publications/alternative-provision)

`r ever_flags_no_star$any_prop_count_AP`% of all children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever been registered at an AP setting (approximately `r format(round(ever_flags_no_star$any_count_AP, -1), big.mark=',')` children), compared to `r ever_flags_no_star$sv_prop_count_AP`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(round(ever_flags_no_star$sv_count_AP, -1), big.mark=',')` children). This compares to only `r ever_flags_no_star$prop_count_AP`% of the all-pupil cohort in `r offender_counts_school$SCHOOL_LA` (approximately `r format(round(ever_flags_no_star$count_AP, -1), big.mark=',')` children). For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$AP)`.

```{r AP chart, echo=FALSE,  fig.cap="**The proportion of all pupils who had ever attended alternative provision by offending and pupil group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.6.1]**"}
AP_chart
```

\newpage

Looking only at pupils that had ever been registered at an AP setting and had attended school in `r offender_counts_school$SCHOOL_LA`, `r ever_flags_no_star$also_any_prop_count_AP`% had ever been cautioned or sentenced for an offence. In addition, `r ever_flags_no_star$also_sv_prop_count_AP`% of those that had ever been registered at an AP setting and had attended school in `r offender_counts_school$SCHOOL_LA` had ever been cautioned or sentenced for a serious violence offence.

```{r AP waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever attended alternative provision, and all pupils who had ever attended alternative provision, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.6.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(AP_LHS_waffle, AP_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

### Timing of AP in relation to offence

*Did the first term a child attended alternative provision (AP) commonly precede the first serious violence offence?*

For children who had been cautioned or sentenced for a serious violence offence, attended school in `r offender_counts_school$SCHOOL_LA`, and had ever been registered at an AP setting, `r AP_timing_no_star$prop_AP_Before_SV`% first attended AP before their first serious violence offence and `r AP_timing_no_star$prop_AP_After_SV`% first attended AP after their first serious violence offence, whilst `r AP_timing_no_star$prop_APSame_Term`% first attended AP in the same term as their first serious violence offence.

```{r AP timing chart, echo=FALSE, eval=NA %!in% AP_timing_for_chart$`% with AP timing`, fig.cap="**The first term children attended alternative provision (AP) relative to the timing of their first offence, for all pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 2.5.1]**"}
AP_timing_chart
```

`r if(NA %in% AP_timing_for_chart$'% with AP timing'){"*Chart has been suppressed due to small numbers.*"}`

```{r SEN, include=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
SEN <- read_excel(data_file,
                  sheet = 'SEN_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

#SEN chart
SEN_for_chart <- SEN %>%
  select(prop_EHCP_all, prop_EHCP_any, prop_EHCP_SV, prop_SEN_support_all, prop_SEN_support_any, prop_SEN_support_SV) %>%
  mutate(prop_NoSEN_all = 100 - prop_EHCP_all - prop_SEN_support_all, prop_NoSEN_any = 100 - prop_EHCP_any - prop_SEN_support_any,
         prop_NoSEN_SV = 100 - prop_EHCP_SV - prop_SEN_support_SV)

SEN_for_chart <- t(SEN_for_chart) %>%
  as.data.frame() %>%
  mutate(Pupil_group = c('All pupils', 'Any offence', 'Serious Violence Offence', 'All pupils', 'Any offence', 'Serious Violence Offence', 'All pupils', 'Any offence', 'Serious Violence Offence')) %>%
  mutate(`SEN type` = c('C - EHCP', 'C - EHCP', 'C - EHCP', 'B - SEN Support', 'B - SEN Support', 'B - SEN Support', 'A - No identified SEN', 'A - No identified SEN', 'A - No identified SEN')) %>%
  rename('perc_SEN' = 'V1')

SEN_for_chart <- SEN_for_chart %>% mutate(perc_SEN = as.numeric(perc_SEN))

SEN_chart <- ggplot(SEN_for_chart, aes(fill=`SEN type`, x=perc_SEN, y=Pupil_group, group=rev(`SEN type`))) +
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% of SEN", y=NULL) +
  geom_text(aes(label = paste0(perc_SEN, "%"), group = rev(`SEN type`)),  position = position_stack(vjust = 0.5), vjust= -5.5, size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text.x = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("No Identified SEN",
                               "SEN Support","EHCP"))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

#SEN timing charts
SEN_timing <- read_excel(data_file,
                         sheet = 'SEN_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

EHCP_timing <- read_excel(data_file,
                          sheet = 'EHCP_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

SEN_timing_for_chart <- SEN_timing %>%
  select(prop_SENSame_Term, prop_SEN_Before_SV, prop_SEN_After_SV)

SEN_timing_for_chart <- t(SEN_timing_for_chart) %>%
  as.data.frame() %>%
  mutate(Timing = c('2 - In the same term as the first serious violence offence', '1 - Before the first serious violence offence',
                    '3 - After the first serious violence offence')) %>%
  rename(`% with timing` = 'V1') %>%
  arrange(Timing)

SEN_timing_for_chart <- SEN_timing_for_chart %>% mutate(`% with timing` = as.numeric(`% with timing`),
                                                        pupil_group = c("Serious Violence Offence","Serious Violence Offence","Serious Violence Offence"))

SEN_timing_chart <- ggplot(SEN_timing_for_chart, aes(x= `% with timing`, y=pupil_group, fill = Timing, group=rev(Timing))) +
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% with SEN timing", y=NULL) +
  geom_text(aes(label = paste0(`% with timing`, "%"), group = rev(Timing)),  position = position_stack(vjust = 0.5), vjust= -12.5, hjust=0, size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text.x = element_text(color="black", size=12)) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("Before the first\nserious violence\noffence",
                               "In the same term\nas the first serious\nviolence offence",
                               "After the first\nserious violence\noffence"))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis title
        legend.text=element_text(size=12)) #change font size of legend text

EHCP_timing_for_chart <- EHCP_timing %>%
  select(prop_EHCPSame_Term, prop_EHCP_Before_SV, prop_EHCP_After_SV)

EHCP_timing_for_chart <- t(EHCP_timing_for_chart) %>%
  as.data.frame() %>%
  mutate(Timing = c('2 - In the same term as the first serious violence offence', '1 - Before the first serious violence offence',
                    '3 - After the first serious violence offence')) %>%
  rename(`% with timing` = 'V1') %>%
  arrange(Timing)

EHCP_timing_for_chart <- EHCP_timing_for_chart %>% mutate(`% with timing` = as.numeric(`% with timing`),
                                                          pupil_group = c("Serious Violence Offence","Serious Violence Offence","Serious Violence Offence"))

EHCP_timing_chart <- ggplot(EHCP_timing_for_chart, aes(x= `% with timing`, y=pupil_group, fill = Timing, group=rev(Timing))) +
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% with EHC plan timing", y=NULL) +
  geom_text(aes(label = paste0(`% with timing`, "%"), group = rev(Timing)),  position = position_stack(vjust = 0.5), vjust= -12.5, hjust=0, size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text.x = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("Before the first\nserious violence\noffence",
                              "In the same term\nas the first serious\nviolence offence",
                               "After the first\nserious violence\noffence"))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text

#SEN waffles

SEN_support_for_waffle <- SEN %>%
  select(prop_SEN_support_SV, prop_also_SEN_support_SV) %>%
  mutate(prop_SEN_support_SV = round(prop_SEN_support_SV,0),
         prop_also_SEN_support_SV = round(prop_also_SEN_support_SV,0),
         non_SEN_support_SV = 100 - prop_SEN_support_SV,
         non_prop_also_SEN_support_SV = 100 - prop_also_SEN_support_SV)

SEN_support_LHS <- SEN_support_for_waffle %>%
  select(prop_SEN_support_SV, non_SEN_support_SV)

SEN_support_RHS <- SEN_support_for_waffle %>%
  select(prop_also_SEN_support_SV, non_prop_also_SEN_support_SV)

SEN_support_LHS_waffle <- waffle(SEN_support_LHS, rows=10, size=0.6, flip=TRUE,
                                 colors=c("#08306b", "#2171b5"),
                                 title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                                 xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("SEN Support",
                               "Not SEN\nSupport")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


SEN_support_RHS_waffle <- waffle(SEN_support_RHS, rows=10, size=0.6, flip=TRUE,
                                 colors=c("#08306b", "#6BACE6"),
                                 title="All pupils who had ever\nhad SEN Support",
                                 xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned or sentenced\nfor a serious violence offence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text

EHCP_for_waffle <- SEN %>%
  select(prop_EHCP_SV, prop_also_EHCP_SV) %>%
  mutate(prop_EHCP_SV = round(prop_EHCP_SV,0),
         prop_also_EHCP_SV = round(prop_also_EHCP_SV,0),
         non_EHCP_SV = 100 - prop_EHCP_SV,
         non_prop_also_EHCP_SV = 100 - prop_also_EHCP_SV)

EHCP_LHS <- EHCP_for_waffle %>%
  select(prop_EHCP_SV, non_EHCP_SV)

EHCP_RHS <- EHCP_for_waffle %>%
  select(prop_also_EHCP_SV, non_prop_also_EHCP_SV)

EHCP_LHS_waffle <- waffle(EHCP_LHS, rows=10, size=0.6, flip=TRUE,
                          colors=c("#08306b", "#2171b5"),
                          title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                          xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("EHC plan",
                               "No EHC\nplan")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


EHCP_RHS_waffle <- waffle(EHCP_RHS, rows=10, size=0.6, flip=TRUE,
                          colors=c("#08306b", "#6BACE6"),
                          title="All pupils who ever had an\nEHC plan",
                          xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned or sentenced\nfor a serious violence offence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


#SEN types

SEN_types_all <- SEN %>%
  select(prop_SPLD_all, prop_MLD_all, prop_SLD_all, prop_PMLD_all, prop_SLCN_all, prop_HI_all, prop_VI_all, prop_MSI_all, prop_PD_all, prop_ASD_all, prop_OTH_all, prop_SEMH_all, prop_NSA_all)

SEN_types_all <- t(SEN_types_all) %>%
  as.data.frame() %>%
  mutate(SEN_type = c('SPLD', 'MLD', 'SLD', 'PMLD', 'SLCN', 'HI', 'VI', 'MSI', 'PD', 'ASD', 'OTH', 'SEMH', 'NSA')) %>%
  rename('perc_SEN_type' = 'V1')

SEN_types_any <- SEN %>%
  select(prop_SPLD_any, prop_MLD_any, prop_SLD_any, prop_PMLD_any, prop_SLCN_any, prop_HI_any, prop_VI_any, prop_MSI_any, prop_PD_any, prop_ASD_any, prop_OTH_any, prop_SEMH_any, prop_NSA_any)

SEN_types_any <- t(SEN_types_any) %>%
  as.data.frame() %>%
  mutate(SEN_type = c('SPLD', 'MLD', 'SLD', 'PMLD', 'SLCN', 'HI', 'VI', 'MSI', 'PD', 'ASD', 'OTH', 'SEMH', 'NSA')) %>%
  rename('perc_SEN_type' = 'V1')

SEN_types_SV <- SEN %>%
  select(prop_SPLD_SV, prop_MLD_SV, prop_SLD_SV, prop_PMLD_SV, prop_SLCN_SV, prop_HI_SV, prop_VI_SV, prop_MSI_SV, prop_PD_SV, prop_ASD_SV, prop_OTH_SV, prop_SEMH_SV, prop_NSA_SV)

SEN_types_SV <- t(SEN_types_SV) %>%
  as.data.frame() %>%
  mutate(SEN_type = c('SPLD', 'MLD', 'SLD', 'PMLD', 'SLCN', 'HI', 'VI', 'MSI', 'PD', 'ASD', 'OTH', 'SEMH', 'NSA')) %>%
  rename('perc_SEN_type' = 'V1')

#Separate SEMH tables

SEMH_all <- SEN_types_all %>%
  filter(SEN_type == 'SEMH')

SEMH_any <- SEN_types_any %>%
  filter(SEN_type == 'SEMH')

SEMH_SV <- SEN_types_SV %>%
  filter(SEN_type == 'SEMH')

#Separate SLCN tables

SLCN_all <- SEN_types_all %>%
  filter(SEN_type == 'SLCN')

SLCN_any <- SEN_types_any %>%
  filter(SEN_type == 'SLCN')

SLCN_SV <- SEN_types_SV %>%
  filter(SEN_type == 'SLCN')

#SEMH timing
SEMH_timing <- read_excel(data_file,
                          sheet = 'SEMH_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

SEMH_timing_for_chart <- SEMH_timing %>%
  select(prop_SEMH_Before_SV, prop_SEMHSame_Term, prop_SEMH_After_SV)

SEMH_timing_for_chart <- t(SEMH_timing_for_chart) %>%
  as.data.frame() %>%
  mutate(Timing = c('1 - Before the first serious violence offence', '2 - In the same term as the first serious violence offence', '3 - After the first serious violence offence')) %>%
  rename(`% with SEMH timing` = 'V1')

SEMH_timing_for_chart <- SEMH_timing_for_chart %>% mutate(`% with SEMH timing` = as.numeric(`% with SEMH timing`),
                                                          pupil_group = c("Serious Violence Offence","Serious Violence Offence","Serious Violence Offence"))

SEMH_timing_chart <- ggplot(SEMH_timing_for_chart, aes(x= `% with SEMH timing`, y=pupil_group, fill = Timing, group=rev(Timing))) +
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% with SEMH timing", y=NULL) +
  geom_text(aes(label = paste0(`% with SEMH timing`, "%"), group = rev(Timing)),  position = position_stack(vjust = 0.5), vjust= -12.5, hjust=0, size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text.x = element_text(color="black", size=12)) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("Before the first\nserious violence\noffence",
                               "In the same term as\nthe first serious\nviolence offence",
                               "After the first\nserious violence\noffence"))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text = element_text(size=12),
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

```

\newpage

## Special Educational Needs

This analysis looks at the proportion of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` who were ever recorded as having Special Educational Needs (SEN)[^22nd_footnote].

[^22nd_footnote]:  The Children and Families Act 2014 and the SEND Code of Practice (2015) covers children and young people with Special Educational Needs and Disabilities (SEND). A child or young person has SEN if they have a learning difficulty or disability which calls for special educational provision to be made for them. Children and young people have a disability if they have a physical or mental impairment which has a long-term and substantial adverse effect on their ability to carry out normal day-to-day activities. Children and young people with a
disability do not necessarily have SEN, or vice-versa, but there is a significant overlap between disabled children and young people and those with SEN. Data collected and published by Department for Education only records children and young people identified with SEN.

A child or young person is classified as having SEN if they have a learning difficulty or disability which calls for special educational provision to be made for them.

Most children with SEN will have their needs met by their education setting with no additional funding from the local authority ('SEN Support')[^24th_footnote], whilst others may undergo a formal assessment resulting in an Education, Health and Care plan (EHC plan)[^25th_footnote] if they are assessed as having a complex need that requires additional provision. It is important to note that this analysis only covers children who have identified SEN, and some children will have unidentified needs and therefore relevant support will not have been put in place.

[^24th_footnote]: Prior to 2014, this category was School Action or School Action Plus. The term ‘SEN Support’ describes the actions taken to support children in mainstream settings who have been identified as having Special Educational Needs (SEN), but who do not have an Education, Health and Care plan (EHC plan). These children receive support and provision from resources already available within the school. Should a child require additional resources that the existing school's SEN Support system does not include, then they can apply for a more detailed EHC plan, which outlines the educational, health and social needs of the individual and the specific provisions in place to support them.

[^25th_footnote]: From 2014 Education, Health and Care plans were introduced. Under previous legislation pupils could be eligible for Statements of SEN. The period for local authorities to transfer children and young people with Statements of SEN to EHC plans started in September 2014
and ended on 31 March 2018. For the purposes of this analysis, ‘EHC plan’ will be used to describe both Statements of SEN and EHC plans unless stated otherwise in the particular context.

Children who had been cautioned or sentenced for an offence or a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` were more likely to be recorded as having SEN (either with SEN Support or with an EHC plan) than the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA`.

Of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA`, `r SEN$prop_SEN_any`% had ever had SEN (approximately `r format(IFERROR(round(as.numeric(SEN$SEN_any), -1)), big.mark=',')` children), compared to `r SEN$prop_SEN_SV`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(as.numeric(SEN$SEN_SV), -1)), big.mark=',')` children). The corresponding proportion is lower for the all-pupil cohort in `r offender_counts_school$SCHOOL_LA`, at `r SEN$prop_SEN_all`%, which is approximately `r format(IFERROR(round(as.numeric(SEN$SEN_all), -1)), big.mark=',')` children. For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$SEN)`.

Of children who had been cautioned or sentenced for any offence and had attended school in `r offender_counts_school$SCHOOL_LA`, `r SEN$prop_EHCP_any`% had ever had an EHC plan (approximately `r format(round(SEN$EHCP_any, -1), big.mark=',')` children), compared to `r SEN$prop_EHCP_SV`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(round(SEN$EHCP_SV, -1), big.mark=',')` children). The corresponding proportion of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` with an EHC plan is lower at `r SEN$prop_EHCP_all`%, which is approximately `r format(round(SEN$EHCP_all, -1), big.mark=',')` children. For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$EHCP)`.

Of children who had been cautioned or sentenced for any offence and had attended school in `r offender_counts_school$SCHOOL_LA`, `r SEN$prop_SEN_support_any`% had ever had SEN Support[^26th_footnote] (approximately `r format(IFERROR(round(as.numeric(SEN$SEN_Support_any), -1)), big.mark=',')` children), compared to `r SEN$prop_SEN_support_SV`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(round(SEN$SEN_support_SV, -1), big.mark=',')` children). The corresponding proportion of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` with SEN Support is lower at `r SEN$prop_SEN_support_all`%, which is approximately `r format(round(SEN$SEN_support_all, -1), big.mark=',')` children.

[^26th_footnote]:  The analysis throughout this publication refers to children with SEN Support as children that had ever been identified as having SEN, but never with an EHC plan.

\newpage

```{r SEN chart, echo=FALSE, fig.cap="**Special Educational Needs (SEN) of all pupils by offending and pupil group, for those that were ever recorded with SEN, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.5.1]**"}
SEN_chart
```

\newpage

`r SEN$prop_SEN_support_SV`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` had ever had SEN Support (without an EHC plan), however only `r SEN$prop_also_SEN_support_SV`% of children who had ever had SEN Support and had attended school in `r offender_counts_school$SCHOOL_LA` were children who were cautioned or sentenced for a serious violence offence.

```{r SEN Support waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever had SEN Support, and all pupils who had ever had SEN Support, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.5.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))
# Use grid.arrange to put plots in columns
grid.arrange(SEN_support_LHS_waffle, SEN_support_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

When looking at children who had ever had an EHC plan, `r SEN$prop_also_EHCP_SV`% of those that had attended school in `r offender_counts_school$SCHOOL_LA` were children who were cautioned or sentenced for a serious violence offence.

```{r EHCP waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever had an EHC plan, and all pupils who had ever had an EHC plan, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.5.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))
# Use grid.arrange to put plots in columns
grid.arrange(EHCP_LHS_waffle, EHCP_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

### Types of SEN

For this analysis, both primary and secondary SEN type have been considered when exploring types of SEN.

The most prevalent type of recorded SEN amongst children who had been cautioned or sentenced for an offence and went to school in `r SEN$SCHOOL_LA` was Social, Emotional and Mental Health needs (SEMH)[^27th_footnote].

[^27th_footnote]:  There were changes to the classification of type of need in 2015 when the previous code of ‘Behaviour, emotional and social difficulties (BESD)’ was removed, and a new code ‘Social, emotional and mental health (SEMH)’ was introduced. However, those with a primary need of BESD in 2014 were not all expected to move to SEMH in 2015. The analysis combined results for the two SEN types, whilst understanding that SEMH was not intended to be a direct replacement for BESD. Results for types of SEN prior to 2015 will include BESD rather than SEMH.

`r SEMH_any$perc_SEN_type`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were recorded with SEMH, compared to `r SEMH_SV$perc_SEN_type`% of
children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA`. The corresponding proportion for the all-pupil
cohort in `r offender_counts_school$SCHOOL_LA` was `r SEMH_all$perc_SEN_type`%.

Another SEN type of interest is Speech, Language and Communication needs (SLCN). `r SLCN_any$perc_SEN_type`% of children who had been cautioned or sentenced for an offence and had attended school in `r SEN$SCHOOL_LA` were recorded with SLCN, compared to `r SLCN_SV$perc_SEN_type`% of
children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA`. The corresponding proportion for the all-pupil cohort in `r offender_counts_school$SCHOOL_LA` was `r SLCN_all$perc_SEN_type`%.

### Timing of the identification of SEN

*Did a child being identified as SEN commonly precede the first serious violence offence?*

For children who had been cautioned or sentenced for a serious violence offence, had attended school in `r offender_counts_school$SCHOOL_LA`, and also had an EHC plan, `r EHCP_timing$prop_EHCP_Before_SV`% first had an EHC plan before their first serious violence offence[^37th_footnote].

[^37th_footnote]: This analysis aims to differentiate between children who had been cautioned or sentenced for an offence, or a serious violence offence, that have received different levels of support. As such, the analysis distinguishes between those that have had SEN Support, but have never had an EHC plan, and those that have had an EHC plan, and when they were first recorded as receiving that support. It is important to note that this does not necessarily equate to when the child was first identified as having SEN.

```{r EHCP timing chart, echo=FALSE, eval=NA %!in% EHCP_timing_for_chart$`% with timing`, fig.cap="**The first term children had an EHC plan, relative to the timing of their first serious violence offence, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 2.6.1]**"}
EHCP_timing_chart
```

`r if(NA %in% EHCP_timing_for_chart$'% with timing'){"*Chart has been suppressed due to small numbers.*"}`

For children who had been cautioned or sentenced for a serious violence offence, attended school in `r offender_counts_school$SCHOOL_LA`, and had ever been recorded with SEN (either with or without an EHC plan), `r SEN_timing$prop_SEN_Before_SV`% were first recorded with SEN before their first serious violence offence.

```{r SEN timing chart, echo=FALSE, eval=NA %!in% SEN_timing_for_chart$`% with timing`, fig.cap="**The first term children had been recorded with SEN, relative to the timing of their first serious violence offence, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 2.6.1]**"}
SEN_timing_chart
```

`r if(NA %in% SEN_timing_for_chart$'% with timing'){"*Chart has been suppressed due to small numbers.*"}`

### Timing of the identification of Social, Emotional and Mental Health (SEMH) needs

As SEMH is consistently the most common recorded SEN type amongst children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA`, further analysis has been carried out on the timing of the identification of SEMH.

For children who had been cautioned or sentenced for a serious violence offence, had attended school in `r offender_counts_school$SCHOOL_LA` and had ever been recorded with SEMH (either with or without an EHC plan), `r SEMH_timing$prop_SEMH_Before_SV`% were first recorded with SEMH before their first serious violence offence.

```{r SEMH timing chart, echo=FALSE, eval=NA %!in% SEMH_timing_for_chart$`% with SEMH timing`, fig.cap="**The first term children had SEMH, relative to the timing of their first serious violence offence, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 2.6.3]**"}
SEMH_timing_chart
```

`r if(NA %in% SEMH_timing_for_chart$'% with SEMH timing'){"*Chart has been suppressed due to small numbers.*"}`

```{r CSC, echo=FALSE, fig.cap="[Source: DfE-MoJ data share, table: ...]"}
CSC <- read_excel(data_file,
                  sheet = 'CiN_CLA_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

CSC_no_star <- read_excel(data_file,
                  sheet = 'CiN_CLA_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

CSC_no_star[CSC_no_star == '*'] <- '(number too small to report)'

CSC_for_chart <- CSC %>%
  select(propcount_CIN, propany_count_CIN, propsv_count_CIN, propcount_CLA, propany_count_CLA, propsv_count_CLA)

CSC_for_chart <- t(CSC_for_chart) %>%
  as.data.frame() %>%
  mutate(`Pupil Group` = c('All Pupils', 'Any Offence', 'Serious Violence Offence', 'All Pupils', 'Any Offence', 'Serious Violence Offence')) %>%
  mutate(CSC_type = c('Children in need', 'Children in need', 'Children in need', 'Children who are looked after', 'Children who are looked after', 'Children who are looked after')) %>%
  rename(`% recorded\nas CIN/CLA` = 'V1')

CSC_for_chart <- CSC_for_chart %>% mutate(`% recorded\nas CIN/CLA` = as.numeric(`% recorded\nas CIN/CLA`))

CSC_chart <- ggplot(CSC_for_chart, aes(fill=`Pupil Group`, y=`% recorded\nas CIN/CLA`, x=rev(CSC_type))) +
  geom_bar(position='dodge', stat='identity') +
  geom_text(aes(label = paste0(`% recorded\nas CIN/CLA`, "%")), vjust = -0.4, hjust=0.5, position = position_dodge(width = 1), size=4) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text = element_text(color="black"),
        axis.title.x = element_blank()) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6")) +
  ylim(0,105) +
  scale_x_discrete(limits = rev, labels = c("Children in need","Children who are\nlooked after")) +
  theme(axis.title.y=element_text(angle=0, size=12))  +
  theme(text=element_text(size=12), #change font size of all text
        axis.text=element_text(size=12), #change font size of axis text
        axis.title=element_text(size=12), #change font size of axis titles
        legend.text=element_text(size=12)) #change font size of legend text

#CSC timing

CSC_timing <- read_excel(data_file,
                         sheet = 'CSC_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

CSC_timing_no_star <- read_excel(data_file,
                         sheet = 'CSC_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

CSC_timing_no_star[CSC_timing_no_star == '*'] <- '(number too small to report)'

CLA_timing <- read_excel(data_file,
                         sheet = 'CLA_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

CLA_timing_no_star <- read_excel(data_file,
                         sheet = 'CLA_timing_sclLA(SAFE)') %>%
  filter(SCHOOL_LA == i)

CLA_timing_no_star[CLA_timing_no_star == '*'] <- '(number too small to report)'

CSC_timing_for_chart <- CSC_timing %>%
  select(prop_CINP_Before_SV, prop_CINPSame_Term, prop_CINP_After_SV,
         prop_CPP_Before_SV, prop_CPPSame_Term, prop_CPP_After_SV)

CLA_timing_for_chart <- CLA_timing %>%
  select(prop_CLA_Before_SV, prop_CLASame_Term, prop_CLA_After_SV)

CSC_timing_for_chart <- cbind(CSC_timing_for_chart, CLA_timing_for_chart)

CSC_timing_chart <- ggplot(CSC_timing_for_chart, aes(x= `% with timing`, y=CSC_type, fill = Timing, group=rev(Timing))) +
  geom_bar(position='stack', stat = "identity", width = 0.7) +
  labs(x = "% with timing", y=NULL) +
  geom_text(aes(label = paste0(`% with timing`, "%"), group = rev(Timing)),  position = position_stack(vjust = 0.5), vjust= -4, hjust=0) +
  theme_classic() +
  theme(legend.position = "bottom", legend.title=element_blank(), axis.text.x = element_text(color="black")) +
  scale_fill_manual(values = c("#08306b", "#2171b5","#4292c6"),
                    labels = c("Before the first\nserious violence\noffence",
                               "In the same term as\nthe first serious\nviolence offence",
                               "After the first\nserious violence\noffence")) +
  theme(text=element_text(size=12))

#CIN waffles

CIN_for_waffle <- CSC %>%
  select(propsv_count_CIN, also_propsv_count_CIN) %>%
  mutate(propsv_count_CIN = round(propsv_count_CIN,0),
         also_propsv_count_CIN = round(also_propsv_count_CIN,0),
         non_propsv_count_CIN = 100 - propsv_count_CIN,
         non_also_propsv_count_CIN = 100 - also_propsv_count_CIN)

CIN_LHS <- CIN_for_waffle %>%
  select(propsv_count_CIN, non_propsv_count_CIN)

CIN_RHS <- CIN_for_waffle %>%
  select(also_propsv_count_CIN, non_also_propsv_count_CIN)

CIN_LHS_waffle <- waffle(CIN_LHS, rows=10, size=0.3, flip=TRUE,
                         colors=c("#08306b", "#2171b5"),
                         title="Children who were cautioned\nor sentenced for a\nserious violence offence",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#2171b5"),
                    labels = c("CIN",
                               "Not CIN")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text


CIN_RHS_waffle <- waffle(CIN_RHS, rows=10, size=0.3, flip=TRUE,
                         colors=c("#08306b", "#6BACE6"),
                         title="All pupils who ever had\never been CIN",
                         xlab="1 square = 1 %") +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, size=9)) +
  scale_fill_manual(values = c("#08306b", "#6BACE6"),
                    labels = c("Children cautioned or sentenced\nfor a serious violence offence",
                               "All other\npupils")) +
  theme(text=element_text(size=12), #change font size of all text
        axis.title=element_text(size=12), #change font size of axis titles
        plot.title=element_text(size=12), #change font size of plot title
        legend.text=element_text(size=12)) #change font size of legend text
```

\newpage

## Children with a Social Worker

The next set of findings look at the proportion of children who had been cautioned or sentenced for an offence that were recorded as being children in need (CIN) or children who are looked after (CLA) on 31st March in any given year, as defined by the Children Act 1989, between 2011/12 – 2017/18 for CIN, and 2005/06 - 2017/18 for CLA[^28th_footnote] [^29th_footnote]. CIN here refers to children who are
designated under a number of different social care classifications: children on a child in need plan; children on a child protection plan[^38th_footnote]; and children who are looked after[^42nd_footnote]. As such, CLA figures are included in the figures for CIN. Since the CIN and CLA data cover different time periods, and CIN includes CLA for some of the same period, comparisons of CIN to CLA should be made with caution. To maximise coverage of the CIN data and avoid skewed results, the analysis in this section is based on children matched to KS4 academic year 2014/15 only.

[^28th_footnote]:  It is important to note on using this measure, the analysis takes no account of how long the children were in need, or in care, and does not count those who were in need, or looked after, during the period specified but were not in need, or looked after specifically on 31st March. As such, the figures stated will be an under-estimate of the true proportion of children in need and children who are looked after.

[^29th_footnote]: This diverges from the definition of Ever CIN used in the CIN Review, which looks at whether the child was recorded as so in the previous 6 years. Please see here for further details: [Children in need of help and protection: data and analysis](https://www.gov.uk/government/publications/children-in-need-of-help-and-protection-data-and-analysis)

[^38th_footnote]: Child Protection Plan (CPP) - support for a child where there is reasonable suspicion that child is suffering, or likely to suffer, significant harm.

[^42nd_footnote]: Children who are looked after (CLA) – a child who is looked after by a local authority if they fall into one of the following: is provided with accommodation, for a continuous period of more than 24 hours (Children Act 1989, Section 20 and 21); is subject to a care order (Children Act 1989, Part IV), or is subject to a placement order. The analysis has not analysed children on a child in need plan (CINP) separately, but rather have looked at all children in need, and the two categories of highest intervention.

When reading the findings related to children looked after (CLA), it is
important to note that the introduction of the Legal Aid, Sentencing and Punishment of Offenders Act 2012 (LASPOA) meant that, from 3rd December 2012, children up to the age of 18 who are remanded to youth detention accommodation as a result of being charged with or convicted of an offence will be ‘looked after’ by the designated local authority[^30th_footnote]. Therefore, caution should be taken when considering the findings related to CLA and offending, as the child may have become CLA due to the offending.

[^30th_footnote]: Please see here for more information: [Children looked after return 2020 to 2021](https://www.gov.uk/government/publications/children-in-need-of-help-and-protection-data-and-analysis)

Overall, children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were more likely to have been both CIN and CLA than the all-pupil cohort in `r offender_counts_school$SCHOOL_LA`.

`r CSC_no_star$propany_count_CIN`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were
children in need on the 31st March in any given year when aged between 12 and 16[^31st_footnote] (approximately `r format(round(CSC_no_star$any_count_CIN, -1), big.mark=',')` children), compared with `r CSC_no_star$propsv_count_CIN`% of children who had been cautioned or
sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(round(CSC_no_star$sv_count_CIN, -1), big.mark=',')` children) and `r CSC_no_star$propcount_CIN`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(round(CSC_no_star$count_CIN, -1), big.mark=',')` children). For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$CIN)`.

[^31st_footnote]:  Full CIN data is available from 2011/12, term 3. Children are included in this CIN analysis if they had been recorded as a child in need on the 31st March in any period between the ages of 12 - 16. Those matched to earlier years in the KS4 attainment data will as a result have less coverage than those matched to later years. For example: those with KS4 academic year 2012/13 have coverage from age 14 and above.

`r CSC_no_star$propany_count_CLA`% of children who had been cautioned or sentenced for an offence and had attended school in `r offender_counts_school$SCHOOL_LA` were CLA on the 31st March in any given year when aged between 6 and 16[^32nd_footnote] (approximately `r format(IFERROR(round(CSC_no_star$any_count_CLA, -1)), big.mark=',')` children),
compared with `r CSC_no_star$propsv_count_CLA`% of children who had been cautioned or sentenced for a serious violence offence and had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(CSC_no_star$sv_count_CLA, -1)), big.mark=',')` children). This compares to `r CSC_no_star$propcount_CLA`% of the all-pupil cohort that had attended school in `r offender_counts_school$SCHOOL_LA` (approximately `r format(IFERROR(round(CSC_no_star$count_CLA, -1)), big.mark=',')` children).For children who had been cautioned or sentenced for a serious violence offence, the difference between these results and the national figure was `r (significance_testing$CLA)`.

[^32nd_footnote]:  Children are included in this CLA analysis if they had been recorded as a child being looked after on the 31st March in any period between the ages of 6 - 16. Those matched to earlier years in the KS4 attainment data will as a result have less coverage than those matched to later years. For example: those with KS4 academic year 2012/13 have coverage from age 8 and above.

```{r CSC chart, echo=FALSE, fig.cap="**The proportion of children who had been recorded as being CIN/CLA on 31st March in any given year, by offending and pupil group, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15. [Source: DfE-MoJ data share, table: 1.4.1]**"}
CSC_chart
```

\newpage

Looking at the CIN and CLA cohorts that had attended school in `r offender_counts_school$SCHOOL_LA`, `r CSC_no_star$also_propsv_count_CIN`% of those who were CIN and `r CSC_no_star$also_propsv_count_CLA`% of those who were CLA, on 31st March in any given year had ever also been
cautioned or sentenced for a serious violence offence. Meaning that, although high proportions of children who had been cautioned or sentenced for a serious violence offence had ever been recorded as CIN or CLA, it is not the case that most children that were ever recorded as CIN or CLA were also cautioned or sentenced for a serious violence offence.

```{r CIN waffle, echo=FALSE, fig.cap="**The proportion of children who had been cautioned or sentenced for a serious violence offence and had ever been CIN on 31st March in any given year, and all pupils who had ever been CIN on 31st March in any given year, for pupils matched to KS4 academic years 2012/13, 2013/14 and 2014/15 [Source: DfE-MoJ data share, table: 1.4.1]**"}
# set the plotting area into a 1*2 array
par(mfrow=c(1,2))

# Use grid.arrange to put plots in columns
grid.arrange(CIN_LHS_waffle, CIN_RHS_waffle, ncol=2, widths=c(1,2))
```

\newpage

### Timing of record of CiN/CLA in relation to offence

*Did the first record of a child being known to children’s social care commonly precede the first serious violence offence?*

The focus of this analysis is to understand the sequencing of a child’s journey between different social care groups relative to the interaction(s) with the criminal justice system they may have had. It looks at children who had been cautioned or sentenced for a serious violence offence and whether their first record of being a child in need, a child on a child protection plan, and/or a
child being looked after occurred before, after or during the same school term as their first serious violence offence (for those recorded as CIN, including CLA, as defined by the Children Act 1989, at any point in a given school term
between 2011/12 – 2017/18 for CIN, and 2004/05 - 2017/18 for CLA).

The analysis presented here utilises a different dataset[^39th_footnote] to that used in the previous section of this publication, enabling more granular examination of those recorded in the children’s social care system at any point during the year, not just on 31st March, and to look at changes in their social care group throughout the year.

[^39th_footnote]: Termly CIN and CLA datasets were provided internally to enable us to complete this analysis. This data is not currently available within the MoJ-DfE data share.

Children who had been cautioned or sentenced for a serious violence offence have been classified here as being CIN, CPP or CLA in an academic term, if at any point in that term they have been recorded as CIN, CPP or CLA[^41st_footnote].

[^41st_footnote]: A child can move between various stages of the social care system within and between terms, including into and out of need. Each child was assigned a termly activity label based on the following hierarchy: CLA – if a child has been looked after for at least one day in that term; CPP – if a child is not labelled as CLA and has been on a child protection plan for at least one day in that term; CIN – a child that falls into any of the two previous categories, or if they are CINP - if a child is not labelled as CLA or CPP and has been in need for at least one day in the term (child in need plan). The legal definition of children in need includes all disabled children. Unlike other children who must be assessed as in need, disabled children are classed as Children in Need by virtue of having a disability. Please see here for more information: [Children in need of help and protection: data and analysis](https://www.gov.uk/government/publications/children-in-need-of-help-and-protection-data-and-analysis)

`r CSC_timing_no_star$prop_CINP_Before_SV`% of children who had been cautioned or sentenced for a serious violence offence, had attended school in `r offender_counts_school$SCHOOL_LA` and were also recorded as a child in need, were recorded as such before their first serious violence offence. For CPP and CLA, the percentages were `r CSC_timing_no_star$prop_CPP_Before_SV`% and `r CLA_timing_no_star$prop_CLA_Before_SV`% respectively.

`r if(CSC_timing_no_star$prop_CINP_Before_SV == "(number too small to report)" | CSC_timing_no_star$prop_CPP_Before_SV == "(number too small to report)" | CLA_timing_no_star$prop_CLA_Before_SV == "(number too small to report)"){"*Results have been suppressed due to small numbers.*"}`

\newpage

# Annex A: Glossary

```{r glossary table, echo = FALSE}
glossary_table <-  data.frame(
  'Item' = c('Alternative Provision (AP)', 'Child Protection Plan (CPP)', 'Children in need (CIN)', 'Children who are looked after (CLA)', 'Free school meals (FSM)', 'Permanent exclusion', 'Persistent absence', 'Persistent absence (unauthorised other)', 'Serious Violence', 'Special Educational Needs (SEN)', 'Suspension'),


  'Definition' = c("Education arranged by local authorities for pupils who, because of permanent exclusion, illness or other reasons, would not otherwise receive suitable education; education arranged by schools for pupils on a fixed period exclusion (suspension); and pupils being directed by schools to off-site provision to improve their behaviour.",

                   "Support for a child where there is reasonable suspicion that child is suffering, or likely to suffer, significant harm. CPP is a subset of CIN.",

                   "Child in need (CIN) is a broad definition spanning a wide range of children and adolescents, in need of varying types of support and intervention, for a variety of reasons. A child is defined as ‘in need’ under section 17 of the Children Act 1989 where:
• they are unlikely to achieve or maintain, or to
have the opportunity of achieving or
maintaining, a reasonable standard of health
or development without the provision for
them of services by a local authority
• their health or development is likely to be
significantly impaired, or further impaired,
without the provision for them of such
services; or
• they are disabled
CPP and CLA are subsets of CIN.",

                   "Under the Children Act 1989, a child is looked after by a local authority if they fall into one of the following:
• is provided with accommodation, for a
continuous period of more than 24 hours
[Children Act 1989, Section 20 and 21]
• is subject to a care order [Children Act 1989,
Part IV]
• is subject to a placement order
CLA is a subset of CIN.",

                   "The metric used in this analysis is FSM eligibility. Children are eligible for FSM if a claim  has been made by them or on their behalf and
either:
• the relevant local authority / school has
confirmed that they are entitled to free school
meals
• the relevant local authority / school has seen
the necessary documentation (that confirms
entitlement to free school meals)
FSM are available to pupils in receipt of, or
whose parents are in receipt of, one or more of
the following benefits:
• Universal Credit (provided you have an
annual net earned income of no more than
£7,400, as assessed by earnings from up to
three of your most recent assessment
periods)
• Income Support
• Income-based Jobseeker’s Allowance
• Income-related Employment and Support
Allowance
• Support under Part VI of the Immigration and
Asylum Act 1999
• The guarantee element of Pension Credit
• Child Tax Credit (provided you are not also
entitled to Working Tax Credit and have an
annual gross income of no more than
£16,190)
• Working Tax Credit run-on – paid for four
weeks after you stop qualifying for Working
Tax Credit",

                   "A permanent exclusion is when a pupil is no longer allowed to attend a school.",

                   "Persistent absence is when a pupil enrolment’s overall absence equates to 10 per cent or more of their possible sessions.",

                   "Persistent absence (unauthorised other) is when a pupil enrolment’s absence due to
‘unauthorised other’ reasons equates to 10 per cent or more of their possible sessions.",

                   "The definition of serious violence used in this paper is broadly based on the following categories of offence groups and offence types:
indictable only ‘violence against the person’ offences, indictable only ‘robbery offences’, and triable either way or indictable only ‘possession of weapons offences’. A full list of offences included in the definition can be found in Annex B. Children who have committed a serious violence offence here therefore relate to young people cautioned or convicted for any of the offences in Annex B.",

                   "A child or young person has SEN if they have a learning difficulty or disability which calls for special educational provision to be made for them i.e., educational or training provision that is additional to or different from that made generally for their peers. A pupil identified as having SEN will either:
• be receiving ‘SEN Support’
• in a minority of cases, have a statutory
Education, Health and Care plan setting out
their complex needs and how these will be
me",

                   "A suspension is where a pupil has been temporarily removed from the school (including during lunchtime). Prior to 2019/20, suspensions were referred to as a fixed period exclusion. Please see here for more information: "

  ),

  stringsAsFactors = FALSE
)

kable(glossary_table,"latex",longtable=T,caption="Here's the table caption.") %>%
  kable_styling(latex_options = "hold_position") %>%
  row_spec(0, bold = T, background = "#9FB9C8") %>%
  column_spec(1:2, width = c("4.2cm","11.8cm"))

```

\newpage

# Annex B: Serious Violence definition - list of offences

```{r sv definition table, echo = FALSE}
sv_definition_table <-  data.frame(
  'Home Office Offence code' = c('00100', '00101', '00102', '00200', '00301', '00302', '00303', '00304', '00305', '00306', '00401', '00402', '00403', '00501', '00504', '00505', '00506', '00507', '00509', '00510', '00513', '00514', '00515', '00516', '00517', '00518', '00519', '00520', '00521', '00522', '00527', '00802', '00804', '00805', '00806', '00833', '00840', '00846', '00859', '03401', '03402', '03410', '02802', '05601', '00803', '00811', '00813', '00814', '00815', '00816', '00817', '00818', '00823', '00824', '00825', '00826', '00827', '00828', '00853', '00854', '00861', '00862', '00863', '00864', '08101', '08103', '08104', '08107', '08108', '08109', '08110', '08111', '08112', '08113', '08114', '08115', '08116', '08117', '08126', '08127', '08129', '08130', '08135', '08136', '08137', '08138', '08139', '08140', '08142', '08143', '08144', '08145', '08169', '08170', '08171', '08172', '08173', '08174', '08176', '08177', '08178', '08179', '08180', '08181', '08182', '08183', '08184', '08185', '08186', '08187', '08188', '08189', '08190', '08191', '09001', '09002', '09003', '09004', '09005', '05914', '05915', '06906'),


  'Offence description' = c('Violence against the person', 'Murder of persons aged 1 year or over', 'Murder of infants under 1 year of age', 'Attempted murder', 'Making threats to kill', 'Conspiracy or soliciting, etc., to commit murder', 'Assisting offender by impeding his apprehension or
prosecution in a case of murder', 'Intentionally encouraging or assisting commission of murder', 'Encouraging or assisting in the commission of murder believing
it will be committed', 'Encouraging or assisting in the commission of one or more
offences of murder believing one or more will be committed', 'Manslaughter', 'Infanticide', 'Child destruction', 'Wounding etc. with intent to do grievous bodily harm etc. or to
resist apprehension', 'Attempting to choke, suffocate etc. with intent to commit an
indictable offence (garrotting)', 'Using chloroform, etc., to commit or assist in committing an
indictable offence', 'Burning, maiming, etc. by explosion', 'Causing, explosions or casting corrosive fluids with intent to do
grievous bodily harm', 'Placing, etc. explosives in or near ships or buildings with intent
to do bodily harm, etc.', 'Endangering life or causing harm by administering poison', 'Possession etc. of explosives with intent to endanger life', 'Possession of firearms etc., with intent to endanger life (Group
I)', 'Possession of firearms etc. with intent to endanger life (Group
II)', 'Possession of firearms etc. with intent to endanger life (Group
III)', 'Using etc. firearms or imitation firearms with intent to resist
arrest etc. (Group I)', 'Using etc. firearms or imitation firearms with intent to resist
arrest etc. (Group II)', 'Using etc. firearms or imitation firearms with intent to resist
arrest etc. (Group III)', 'Use etc. of chemical weapons', 'Use of premises or equipment for producing chemical
weapons', 'Use, threat of use, production or possession of a nuclear
weapon', 'Torture', 'Administering poison with intent to injure or annoy', 'Causing bodily harm by furious driving', 'Assaults on person preserving wreck', 'Assaults occasioning actual bodily harm', 'Racially aggravated wounding or inflicting grievous bodily
harm (inflicting bodily injury with or without weapon)', 'Religiously aggravated malicious wounding or grievous bodily
harm', 'Racially or religiously aggravated malicious wounding or
grievous bodily harm (GBH)', 'Racially or religiously aggravated wounding or grievous bodily
harm', 'Robbery', 'Assault with intent to rob', 'Robbery', 'Burglary in a dwelling with intent to inflict grievous bodily harm
- indictable only', 'Arson endangering life', 'Setting spring guns etc. to injure trespassers', 'Possession of offensive weapons without lawful authority or
reasonable excuse', 'Possessing firearm or imitation firearm at time of committing or
being arrested for an offence specified in Schedule 1 of the Act
(Group I)', 'Possessing firearm or imitation firearm at time of committing or
being arrested for an offence specified in Schedule 1 of the Act
(Group II)', 'Possessing firearm or imitation firearm at time of committing or
being arrested for an offence specified in Schedule 1 of the Act
(Group III)', 'Possessing firearm or imitation firearm with intent to commit an
indictable offence or resist arrest etc (Group I)', 'Possessing firearm or imitation firearm with intent to commit an
indictable offence, or resist arrest etc (Group II)', 'Possessing firearm or imitation firearm with intent to commit an
indictable offence, or resist arrest etc (Group III)', '00823', 'Possession of a firearm or imitation firearm, with intent to
cause fear of violence
(Group I)', 'Possession of a firearm or imitation firearm with intent to cause
fear of violence
(Group II)', 'Possession of a firearm or imitation firearm with intent to cause
fear of violence (Group III)', 'Having an article with a blade or point in a public place', 'Having an article with a blade or point on school premises', 'Possession of offensive weapons without lawful authority or
reasonable excuse on school premises', 'Using another to look after, hide or transport a dangerous
weapon - offensive weapon, knife or bladed weapon', 'Using another to look after, hide or transport a dangerous
weapon - a firearm', 'Threaten with an offensive weapon in a public place', 'Threaten with a blade or sharply pointed article on school
premises', 'Threaten with an offensive weapon on school premises', 'Threaten with blade/sharply pointed article in a public place', 'Possession of weapons', 'Possessing etc. firearm or ammunition without firearm
certificate (Group I)', 'Possessing etc. shotgun without certificate (Group II)', 'Trading in firearms without being registered as a firearms
dealer (Group I)', 'Trading in firearms without being registered as a firearms
dealer', 'Selling firearm to person without a certificate (Group I)', 'Selling firearm to person without a certificate (Group II)', 'Repairing, testing etc. firearm for person without a certificate
(Group I)', 'Repairing, testing etc. firearm for person without a certificate
(Group II)', 'Falsifying certificate etc. with a view to acquisition of firearm
(Group I)', 'Falsifying certificate etc. with a view to acquisition of firearm
(Group II)', 'Shortening a shotgun or other smooth bore gun (Group I)', 'Conversion of firearms (Group I)', 'Possessing or distributing prohibited weapons or ammunition
(Group I)', 'Carrying firearm in public place etc. (Group I)', 'Carrying loaded firearm in public place etc. (Group II)', 'Trespassing with firearm or imitation firearm in a building
(Group I)', 'Trespassing with firearm or imitation firearm in a building
(Group II)', 'Possession of firearms by persons previously convicted of
crime (Group I)', 'Possession of firearms by persons previously convicted of
crime (Group II)', 'Possession of firearms by persons previously convicted of
crime (Group III)', 'Supplying firearms to person denied them under Section 21
(Group I)', 'Supplying firearms to person denied them under Section 21
(Group II)', 'Supplying firearms to person denied them under Section 21
(Group III)', 'Failure to transfer firearms or ammunition in person (Group I)', 'Failure to give notice in writing to the Chief Officer of Police of
transfers involving firearms (Group I)', 'Failure by certificate holder to notify in writing Chief Officer of
Police of deactivation, destruction or loss of firearms or
ammunition (Group I)', 'ammunition (Group I)
08145 Failure by certificate holder to notify in writing Chief Officer of
Police of events taking place outside Great Britain involving
firearms and ammunition (sold or otherwise disposed of, lost
etc) (Group I)', 'Possession of weapons', 'Possessing or distributing prohibited weapons designed for
discharge of noxious liquid etc. (Group I)', 'Possessing or distributing firearm disguised as other object
(Group I)', 'Possessing or distributing other prohibited weapons', 'Offence in relation to the unlawful IMPORTATION of any
weapon or ammunition of a kind mentioned in
S.5(1)(a),(ab),(aba),(ac), (ad),(ae),(af) or (c) of the Firearms
Act 1968', 'Selling or transferring an air weapon unlawfully', 'Carrying a loaded or unloaded or imitation firearm or air
weapon in public place', 'Knowingly being concerned in activity prohibited by Parts 2, 3
or 4 of the Order with intent to evade the relevant prohibition', 'Unship / unload prohibited weapon / ammunition with intent to
evade prohibition / restriction', 'Remove prohibited weapons / ammunition from their place of
importation with intent to evade prohibition / restriction', 'Import prohibited weapons / ammunition with intent to evade a
prohibition / restriction', 'Export prohibited weapon / ammunition with intent to evade
prohibition / restriction', 'Carry / remove / deposit etc. prohibited weapons / ammunition
with intent to evade a prohibition / restriction', 'Knowingly concerned in fraudulent evasion of prohibition /
restriction on prohibited weapon / ammunition', 'Manufacture weapon / ammunition specified in section 5(1) of
the Firearms Act 1968', 'Sell / transfer prohibited weapon / ammunition', 'Possess prohibited weapon / ammunition for sale / transfer', 'Purchase / acquire prohibited weapon / ammunition for sale /
transfer', 'Offences under Explosives Precursors Regulations 2014', 'Manufacture an offensive weapon; Possess article for use in
connection with conversion of imitation firearm', 'Make / sell / give as gift defectively deactivated weapon -
Police and Crime Act 2017', 'Unlawful marketing of knives (selling or hiring)', 'Unlawful marketing of knives (offering or exposing to sell or
hire)', 'Unlawful marketing of knives - having in possession for the
purpose of sale or hire', 'Publication of any written, pictorial or other material in
connection with the marketing of any knife - the material
suggesting or indicating knife suitable for combat', 'Publication of any written, pictorial or other material in
connection with the marketing of any knife - the material is
otherwise likely to stimulate or encourage violent behaviour
involving use of the knife as a weapon', 'Manufacture, possession or control of explosives under
suspicious circumstances', 'Possessing or making an explosive substance, a noxious or
dangerous thing, a machine, engine or instrument with intent
to commit an offence under the Offences against the Person
Act 1861', 'Unauthorised possession in prison of knife or offensive
weapon'),

  stringsAsFactors = FALSE
)

colnames(sv_definition_table) <- c("Home Office Offence code","Offence description")
kable(sv_definition_table,"latex",longtable=T,caption="Here's the table caption.") %>%
  kable_styling(latex_options = "hold_position") %>%
  row_spec(0, bold = T, background = "#9FB9C8") %>%
  column_spec(1:2, width = c("3.2cm","12.8cm"))

```

\newpage

# Annex C: Data sources

Most of the DfE data used in the descriptive statistics analysis is taken from the school census, which is a pupil-level data collection from primary, secondary, special and state-funded alternative provision (AP) schools (pupil referral units, AP academies and AP free schools). The school census takes place three times a year; in the Autumn, Spring and Summer terms. Data from the Pupil Referral Unit (PRU) and the AP censuses is also included. The PRU census was a yearly Spring collection census of all state-funded AP settings which was incorporated into the school census in 2013/14. The AP census is also a yearly Spring census. Since the AP and PRU censuses are yearly, missing termly data for Autumn and Summer terms was inferred from the Spring data collection of the same academic year, where appropriate. Additionally, some data is collected in the school census that is not collected in the AP and PRU census. Where appropriate, this missing data has been filled in from the school census.

To be aware; in most cases, where pupils are registered in two schools, the pupil’s main record from the school census was used to obtain information about the pupil. However, in some cases, existence of a dual-subsidiary record was noted, and the student flagged as attending more than one educational setting. We have incorporated information from pupil’s subsidiary records for school, Local Authority and SEN, in order to capture as much information as possible.

In addition to this, examination data was also included. This data was matched onto the school census base data at a pupil-level from the KS2 and KS4 examination data. Where duplicate results existed for students, the latest academic year was taken. If duplicates remained, the highest score was used.

\newpage

## Ethnicity data

Data on a child’s ethnicity is taken from the School Census. As of 2011, information regarding ethnicity could only be provided by the child or their parent(s).

```{r ethnicity annex table, echo = FALSE, fig.cap="**Ethnic group major categories**"}
ethnicity_major_annex_table <-  data.frame(
  'Code' = c('AOEG', 'ASIA', 'BLAC', 'CHIN', 'MIXD', 'UNCL', 'WHIT'),

  'Ethnic group' = c("Any Other Ethnic Group", "Asian", "Black", "Chinese", "Mixed", "Unclassified", "White"),

  stringsAsFactors = FALSE
)

kable((ethnicity_major_annex_table),
      col.names = gsub(" 1","/1",gsub("Academic Year ","",gsub("[.]"," ",names(ethnicity_major_annex_table)))),
      caption = "Ethnic Group Major categories",
      format='latex',longtable=T, position='!h') %>%
  row_spec(0, bold = T, background = "#9FB9C8")
```

```{r ethnicity minor annex table, echo = FALSE, fig.cap="**Ethnic group minor categories**"}
ethnicity_minor_annex_table <-  data.frame(
  'Code' = c('ABAN', 'AIND', 'AOTH', 'APKN', 'BAFR', 'BCRB', 'BOTH', 'CHNE', 'MOTH', 'MWAS', 'MWBA', 'MWBC', 'NOBT', 'OOTH', 'REFU', 'WBRI', 'WIRI', 'WIRT', 'WOTH', 'WROM'),

  'Ethnic group' = c("Bangladeshi", "Indian", "Any Other Asian Background", "Pakistani", "Black African", "Black Caribbean", "Any Other Black Background", "Chinese", "An Other Mixed Background", "White and Asian", "White and Black African", "White and Black Caribbean", "Information Not Yet Obtained", "Any Other Ethnic Group", "Refused", "White British", "White Irish", "Travellor of Irish Heritage", "Any Other White Background", "Gypsy/Roma"),

  stringsAsFactors = FALSE
)

kable((ethnicity_minor_annex_table),
      col.names = gsub(" 1","/1",gsub("Academic Year ","",gsub("[.]"," ",names(ethnicity_minor_annex_table)))),
      caption = "Ethnic Group Minor categories",
      format='latex', longtable=T, longtable=T, position='!h') %>%
  row_spec(0, bold = T, background = "#9FB9C8")
```

\newpage

## Children known to children's social care data

Data from the children in need (CIN) census and children who are looked after (CLA) census was also included. In sections 1, 3 and 4 of the publication, the CIN and CLA data used indicates whether a given pupil was CIN or CLA on the 31st March in a given year. This differs from the measures used in the annual publication ‘Children looked after in England including adoptions’, which looks at whether the child was recorded as being looked after on 31st March in the previous year; whether the child started being looked after during the previous year ending 31st March; and for offending specifically, whether the child had been looked after for at least 12 months in the year ending 31st March. For section 2, termly CIN and CLA datasets were used which were provided internally. This is the only piece of analysis that has used data that is not available for external users of the data share.

## Special Educational Needs data

Pupils identified with Special Educational Needs (SEN) are classified as those that have a statement of SEN or Education, Health and Care (EHC) plan (or, prior to reforms introduced in September 2014, a Statement of SEN) and those who are in the SEN Support category (or, prior to reforms introduced in September 2014, School Action or School Action Plus). The period for local authorities to transfer children and young people with Statements of SEN to EHC plans started in September 2014 and ended on 31 March 2018.


```{r sen annex table, echo = FALSE, fig.cap="**Special Educational Needs categories**"}
sen_annex_table <-  data.frame(
  'Code' = c('ASD', 'HI', 'MLD', 'MSI', 'PD', 'PMLD', 'SEMH', 'BESD', 'SLCN', 'SLD', 'SPLD', 'VI', 'OTH'),

  'SEN primary need' = c("Autistic spectrum disorder", "Hearing impairment", "Moderate learning difficulty", "Multi-sensory impairment", "Physical disability", "Profound & multiple learning difficulty", "Social, emotional & mental health", "Behaviour, emotional & socal difficulties", "Speech, language &
communication", "Severe learning difficulty", "Specific learning difficulty", "Visual impairment", "Other difficulty/disability"),

  stringsAsFactors = FALSE
)

kable((sen_annex_table),
      col.names = gsub(" 1","/1",gsub("Academic Year ","",gsub("[.]"," ",names(sen_annex_table)))),
      caption = "Special Educational Needs categories",
      format='latex',
      position='!h') %>%
  row_spec(0, bold = T, background = "#9FB9C8")
```

Primary type of need is collected through the school census for those pupils on SEN Support, or EHC plan (or the pre-2014 equivalents). The coverage for January 2015 onwards is different to previous years. Pupils who were on School Action were not required to have a primary type of need recorded. From 2015 pupils who were on School Action who have transferred to SEN Support will be recorded as having a primary type of need. This has led to an increase in the number of pupils recorded as having a primary type of need. There were changes to the classification of type of need in 2015: the previous code of ‘Behaviour, Emotional and Social Difficulties (BESD)’ was removed. A new code ‘Social, Emotional and Mental Health (SEMH)’ was introduced, although this was not intended to be a direct replacement.


\newpage

\resizebox{48mm}{!}{\includegraphics{images/Department_for_Education.png}}
\vspace*{\fill}
\color{black}
© Crown copyright 2022

This publication (not including logos) is licensed under the terms of the Open Government Licence v3.0 except where otherwise stated. Where we have identified any third party copyright information you will need to obtain permission from the copyright holders concerned.

To view this licence:

\begin{tabular}{p{0.02\linewidth} p{0.1\linewidth} p{0.88\linewidth}}
& visit & www.nationalarchives.gov.uk/doc/open-government-licence/version/3 \\
& email & psi@nationalarchives.gsi.gov.uk \\
& write to & Information Policy Team, The National Archives, Kew, London, TW9 4DU \\
\end{tabular}

About this publication:

\begin{tabular}{p{0.02\linewidth} p{0.1\linewidth} p{0.88\linewidth}}
& enquiries & www.education.gov.uk/contactus \\
& download & www.gov.uk/government/publications \\
\end{tabular}

\begin{tabular}{p{0.08\linewidth} p{0.24\linewidth} p{0.08\linewidth} p{0.36\linewidth}}
& Follow us on Twitter: & & Like us on Facebook: \\
& @educationgovuk & & facebook.com/educationgovuk \\
\end{tabular}
